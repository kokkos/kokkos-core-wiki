<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="7. Parallel dispatch" href="ParallelDispatch.html" /><link rel="prev" title="5. Initialization" href="Initialization.html" />

    <meta name="generator" content="sphinx-4.3.2, furo 2022.01.02"/>
        <title>6: View: Multidimensional array - Kokkos documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=df49af52631e7917044a9c21a57f7b83170a6dd0" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=fade93df149f7c5fedb3ff897f799dc7d283b420" />
    <link rel="stylesheet" type="text/css" href="../_static/hacks.css" />
    
    


<style>
  body {
    --color-code-background: #002b36;
  --color-code-foreground: #839496;
  
  }
  body[data-theme="dark"] {
    --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
  }
  @media (prefers-color-scheme: dark) {
    body:not([data-theme="light"]) {
      --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
    }
  }
</style></head>
  <body>
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" />
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Kokkos  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">Kokkos  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="../programmingguide.html">Programming Guide</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Introduction.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="Machine-Model.html">2. Machine Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="ProgrammingModel.html">3: Programming Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="Compiling.html">4. Compiling</a></li>
<li class="toctree-l2"><a class="reference internal" href="Initialization.html">5. Initialization</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">6: View: Multidimensional array</a></li>
<li class="toctree-l2"><a class="reference internal" href="ParallelDispatch.html">7. Parallel dispatch</a></li>
<li class="toctree-l2"><a class="reference internal" href="HierarchicalParallelism.html">8. Hierarchical Parallelism</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="Custom-Reductions.html">9. Custom Reductions</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="Custom-Reductions-Built-In-Reducers.html">9.1 Built-In-Reducers</a></li>
<li class="toctree-l3"><a class="reference internal" href="Custom-Reductions-Built-In-Reducers-with-Custom-Scalar-Types.html">9.2 Built-In Reducers with Custom Scalar Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="Custom-Reductions-Custom-Reducers.html">9.3 Custom Reducers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Atomic-Operations.html">10. Atomic Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="Subviews.html">11: Subviews</a></li>
<li class="toctree-l2"><a class="reference internal" href="Interoperability.html">12. Interoperability and Legacy Codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="Kokkos-and-Virtual-Functions.html">13. Kokkos and Virtual Functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../building.html">Build, Install and Use</a></li>
<li class="toctree-l1"><a class="reference internal" href="../keywords.html">CMake Keywords</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../API/core-index.html">API: Core</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../API/core/Initialize-and-Finalize.html">Initialize and Finalize</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../API/core/initialize_finalize/initialize.html">Kokkos::initialize</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/initialize_finalize/finalize.html">Kokkos::finalize</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/initialize_finalize/ScopeGuard.html">Kokkos::ScopeGuard</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../API/core/View.html">View and related</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../API/core/view/create_mirror.html"><code class="docutils literal notranslate"><span class="pre">create_mirror[_view]</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/view/deep_copy.html"><code class="docutils literal notranslate"><span class="pre">deep_copy()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/view/layoutLeft.html"><code class="docutils literal notranslate"><span class="pre">LayoutLeft</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/view/layoutRight.html"><code class="docutils literal notranslate"><span class="pre">LayoutRight</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/view/layoutStride.html"><code class="docutils literal notranslate"><span class="pre">LayoutStride</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/view/realloc.html"><code class="docutils literal notranslate"><span class="pre">realloc</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/view/resize.html"><code class="docutils literal notranslate"><span class="pre">resize</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/view/subview.html"><code class="docutils literal notranslate"><span class="pre">subview</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/view/view.html"><code class="docutils literal notranslate"><span class="pre">View</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/view/view_alloc.html"><code class="docutils literal notranslate"><span class="pre">view_alloc()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/view/view_like.html">View-like Types</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../API/core/ParallelDispatch.html">Parallel Execution/Dispatch</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../API/core/parallel-dispatch/parallel_for.html"><code class="docutils literal notranslate"><span class="pre">parallel_for()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/parallel-dispatch/parallel_reduce.html"><code class="docutils literal notranslate"><span class="pre">parallel_reduce()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/parallel-dispatch/parallel_scan.html"><code class="docutils literal notranslate"><span class="pre">parallel_scan()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/parallel-dispatch/fence.html"><code class="docutils literal notranslate"><span class="pre">fence()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/parallel-dispatch/ParallelForTag.html"><code class="docutils literal notranslate"><span class="pre">ParallelForTag()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/parallel-dispatch/ParallelReduceTag.html"><code class="docutils literal notranslate"><span class="pre">ParallelReduceTag()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/parallel-dispatch/ParallelScanTag.html"><code class="docutils literal notranslate"><span class="pre">ParallelScanTag()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../API/core/builtin_reducers.html">Built-in Reducers</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../API/core/builtinreducers/ReducerConcept.html"><code class="docutils literal notranslate"><span class="pre">ReducerConcept</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/builtinreducers/BAnd.html"><code class="docutils literal notranslate"><span class="pre">BAnd</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/builtinreducers/BOr.html"><code class="docutils literal notranslate"><span class="pre">BOr</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/builtinreducers/LAnd.html"><code class="docutils literal notranslate"><span class="pre">LAnd</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/builtinreducers/LOr.html"><code class="docutils literal notranslate"><span class="pre">LOr</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/builtinreducers/Max.html"><code class="docutils literal notranslate"><span class="pre">Max</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/builtinreducers/MaxLoc.html"><code class="docutils literal notranslate"><span class="pre">MaxLoc</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/builtinreducers/Min.html"><code class="docutils literal notranslate"><span class="pre">Min</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/builtinreducers/MinLoc.html"><code class="docutils literal notranslate"><span class="pre">MinLoc</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/builtinreducers/MinMax.html"><code class="docutils literal notranslate"><span class="pre">MinMax</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/builtinreducers/MinMaxLoc.html"><code class="docutils literal notranslate"><span class="pre">MinMaxLoc</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/builtinreducers/Prod.html"><code class="docutils literal notranslate"><span class="pre">Prod</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/builtinreducers/Sum.html"><code class="docutils literal notranslate"><span class="pre">Sum</span></code></a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../API/core/builtinreducers/ReductionScalarTypes.html">Reduction Scalar Types</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../API/core/builtinreducers/MinMaxLocScalar.html"><code class="docutils literal notranslate"><span class="pre">MinMaxLocScalar</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../API/core/builtinreducers/MinMaxScalar.html"><code class="docutils literal notranslate"><span class="pre">MinMaxScalar</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../API/core/builtinreducers/ValLocScalar.html"><code class="docutils literal notranslate"><span class="pre">ValLocScalar</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../API/core/Execution-Policies.html">Execution Policies</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../API/core/policies/ExecutionPolicyConcept.html"><code class="docutils literal notranslate"><span class="pre">ExecutionPolicy</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/policies/MDRangePolicy.html"><code class="docutils literal notranslate"><span class="pre">MDRangePolicy</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/policies/NestedPolicies.html"><code class="docutils literal notranslate"><span class="pre">NestedPolicies</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/policies/RangePolicy.html"><code class="docutils literal notranslate"><span class="pre">RangePolicy</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/policies/TeamHandleConcept.html"><code class="docutils literal notranslate"><span class="pre">TeamHandleConcept</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/policies/TeamPolicy.html"><code class="docutils literal notranslate"><span class="pre">TeamPolicy</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/policies/TeamThreadRange.html"><code class="docutils literal notranslate"><span class="pre">TeamThreadRange</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/policies/TeamVectorRange.html"><code class="docutils literal notranslate"><span class="pre">TeamVectorRange</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/policies/ThreadVectorRange.html"><code class="docutils literal notranslate"><span class="pre">ThreadVectorRange</span></code></a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../API/core/Spaces.html">Spaces</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../API/core/execution_spaces.html">Execution Spaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/memory_spaces.html">Memory Spaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/SpaceAccessibility.html">Space Accessibility</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../API/core/Task-Parallelism.html">Task-Parallelism</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../API/core/atomics.html">Atomics</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../API/core/atomics/atomic_compare_exchange.html"><code class="docutils literal notranslate"><span class="pre">atomic_compare_exchange</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/atomics/atomic_compare_exchange_strong.html"><code class="docutils literal notranslate"><span class="pre">atomic_compare_exchange_strong</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/atomics/atomic_exchange.html"><code class="docutils literal notranslate"><span class="pre">atomic_exchange</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/atomics/atomic_fetch_op.html"><code class="docutils literal notranslate"><span class="pre">atomic_fetch_[op]</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/atomics/atomic_load.html"><code class="docutils literal notranslate"><span class="pre">atomic_load</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/atomics/atomic_op.html"><code class="docutils literal notranslate"><span class="pre">atomic_[op]</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/atomics/atomic_op_fetch.html"><code class="docutils literal notranslate"><span class="pre">atomic_[op]_fetch</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/atomics/atomic_store.html"><code class="docutils literal notranslate"><span class="pre">atomic_store</span></code></a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../API/core/Numerics.html">Numerics</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../API/core/numerics/mathematical-constants.html">Mathematical constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/numerics/mathematical-functions.html">Common math functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/numerics/numeric-traits.html">Numeric traits</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../API/core/CStyleMemManagement.html">C-style memory management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../API/core/Traits.html">Traits</a></li>
<li class="toctree-l2"><a class="reference internal" href="../API/core/KokkosConcepts.html">Kokkos Concepts</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../API/core/STL-Compatibility.html">STL Compatibility Issues</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../API/core/stl-compat/pair.html"><code class="docutils literal notranslate"><span class="pre">Kokkos::pair</span></code></a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../API/core/Utilities.html">Utilities</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../API/core/utilities/abort.html"><code class="docutils literal notranslate"><span class="pre">Kokkos::abort</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/utilities/complex.html"><code class="docutils literal notranslate"><span class="pre">Kokkos::complex</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/utilities/timer.html"><code class="docutils literal notranslate"><span class="pre">Kokkos::Timer</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../API/core/Detection-Idiom.html">Detection Idiom</a></li>
<li class="toctree-l2"><a class="reference internal" href="../API/core/Macros.html">Macros</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../API/containers-index.html">API: Containers</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../API/containers/Bitset.html"><code class="docutils literal notranslate"><span class="pre">Bitset</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../API/containers/Bitset.html#constbitset"><code class="docutils literal notranslate"><span class="pre">ConstBitset</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../API/containers/DualView.html"><code class="docutils literal notranslate"><span class="pre">DualView</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../API/containers/DynamicView.html"><code class="docutils literal notranslate"><span class="pre">DynamicView</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../API/containers/DynRankView.html"><code class="docutils literal notranslate"><span class="pre">DynRankView</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../API/containers/Offset-View.html"><code class="docutils literal notranslate"><span class="pre">OffsetView</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../API/containers/ScatterView.html"><code class="docutils literal notranslate"><span class="pre">ScatterView</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../API/containers/StaticCrsGraph.html"><code class="docutils literal notranslate"><span class="pre">StaticCrsGraph</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../API/containers/Unordered-Map.html"><code class="docutils literal notranslate"><span class="pre">UnorderedMap</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../API/containers/vector.html"><code class="docutils literal notranslate"><span class="pre">vector</span></code></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../API/algorithms-index.html">API: Algorithms</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../API/algorithms/Random-Number.html">Random-Number</a></li>
<li class="toctree-l2"><a class="reference internal" href="../API/algorithms/Random-Number.html#generator">Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../API/algorithms/Sort.html">Sort</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../API/algorithms/std-algorithms-index.html">Std Algorithms</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../API/algorithms/std-algorithms/Iterators.html">Iterators</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/algorithms/std-algorithms/StdMinMaxElement.html">Minimum/maximum</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/algorithms/std-algorithms/StdModSeq.html">Modifying Sequence</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/algorithms/std-algorithms/StdNonModSeq.html">NonModifying Sequence</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/algorithms/std-algorithms/StdNumeric.html">Numeric</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/algorithms/std-algorithms/StdPartioningOps.html">Partitioning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/algorithms/std-algorithms/StdSorting.html">Sorting</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../API/alphabetical.html">API in Alphabetical Order</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../usecases.html">Use Cases and Examples</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../usecases/MPI-Halo-Exchange.html">MPI Halo Exchange</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usecases/Average-To-Nodes.html">ScatterView averaging elements to nodes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usecases/MDRangePolicy.html">MDRangePolicy Use Case</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usecases/VirtualFunctions.html">Virtual Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usecases/TaggedOperators.html">Tagged Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usecases/OverlappingHostAndDeviceWork.html">Overlapping Host and Device work</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usecases/Tasking.html">Kokkos Tasking Use Case</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usecases/Kokkos-Fortran-Interoperability.html">Fortran Interop Use Case</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usecases/SoA-and-AoSoA-with-Cabana.html">Array of Structures and Structure of Arrays with Cabana</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../testing-and-issue-tracking.html">Testing and Issue Tracking</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../testing-and-issue-tracking/Requirements-Issues-and-Feedback.html">Requirements, Issues and Feedback</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing-and-issue-tracking/Testing-Process-Details.html">Attachments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing-and-issue-tracking/Testing-Processes.html">Kokkos Testing Processes and Change Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing-and-issue-tracking/Testing-Workflow-Components.html">Kokkos Testing Workflow Components</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/kokkos/kokkos-tutorials">Tutorials</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../videolectures.html">Video lectures</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference external" href="https://www.youtube.com/watch?v=rUIcWtFU5qM">1. Intro, Build, Parallel dispatch</a></li>
<li class="toctree-l2"><a class="reference external" href="https://www.youtube.com/watch?v=O-asHTtO7O4">2. Views and Spaces</a></li>
<li class="toctree-l2"><a class="reference external" href="https://www.youtube.com/watch?v=nGyJS8u-6GY">3. Multidim loops and Data Structures</a></li>
<li class="toctree-l2"><a class="reference external" href="https://www.youtube.com/watch?v=s9ecpeWRePs">4. Hierarchical Parallelism</a></li>
<li class="toctree-l2"><a class="reference external" href="https://www.youtube.com/watch?v=xEAyOod57-c">5. SIMD, Streams, Tasking</a></li>
<li class="toctree-l2"><a class="reference external" href="https://www.youtube.com/watch?v=1J3JQ3d3cRc&amp;t=1s">6. Fortran/Python interop, MPI, PGAS</a></li>
<li class="toctree-l2"><a class="reference external" href="https://www.youtube.com/watch?v=MH6zFYGw0HU">7. Kokkos Tools</a></li>
<li class="toctree-l2"><a class="reference external" href="https://www.youtube.com/watch?v=_qD4X66MQF8&amp;t=1s">8. Kokkos Kernels Math Library</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/kokkos/kokkos">GitHub Repo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../citation.html">Citing Kokkos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <div class="section" id="view-multidimensional-array">
<h1>6: View: Multidimensional array<a class="headerlink" href="#view-multidimensional-array" title="Permalink to this headline">¶</a></h1>
<p>After reading this chapter, you should understand the following:</p>
<ul class="simple">
<li><p>A Kokkos View is an array of zero or more dimensions</p></li>
<li><p>How to use View’s first template parameter to specify the type of entries, the number of dimensions, and whether the dimensions are determined at run time or compile time</p></li>
<li><p>Kokkos handles array deallocation automatically</p></li>
<li><p>Kokkos chooses array layout at compile time for best overall performance as a function of the computer architecture</p></li>
<li><p>How to set optional template parameters of View for low-level control of execution space, layout, and how Kokkos accesses array entries</p></li>
</ul>
<p>In all code examples in this chapter, we assume that all classes in the <code class="docutils literal notranslate"><span class="pre">Kokkos</span></code> namespace have been imported into the working namespace.</p>
<div class="section" id="why-kokkos-needs-multidimensional-arrays">
<h2>6.1 Why Kokkos needs multidimensional arrays<a class="headerlink" href="#why-kokkos-needs-multidimensional-arrays" title="Permalink to this headline">¶</a></h2>
<p>Many scientific and engineering codes spend a lot of time computing with arrays of data and programmers invest a lot of effort making these array computations as fast as possible. This effort is often intimately bound to details of the computer architecture, run-time environment, language, and programming model. For example, optimal array layout may differ based on the architecture, with a large integer factor penalty if wrong. Low-level issues like pointer alignment, array layout, indexing overhead, and initialization all affect performance. This is true even for sequential codes but thread parallelism adds even more pitfalls, like first-touch allocation and false sharing.</p>
<p>For best performance, coders need to tie details of how they manage arrays to details of how parallel code accesses and manages those arrays. Programmers who write architecture-specific code then need to mix low-level features of the architecture and programming model into high-level algorithms. This makes it hard to port codes between architectures, or to write a code that still performs well as architectures evolve.</p>
<p>Kokkos aims to relieve some of this burden by optimizing array management and access for the specific architecture. Tying arrays to shared-memory parallelism lets Kokkos optimize the former to the latter. For example, Kokkos can easily do first-touch allocation because it controls threads that it can use to initialize arrays. Kokkos’ architecture-awareness lets it pick optimal layout and pad allocations for good alignment. Expert coders can also use Kokkos to access low-level or more architecture-specific optimizations in a more user-friendly way. For instance, Kokkos makes it easy to experiment with different array layouts.</p>
</div>
<div class="section" id="creating-and-using-a-view">
<h2>6.2 Creating and using a View<a class="headerlink" href="#creating-and-using-a-view" title="Permalink to this headline">¶</a></h2>
<div class="section" id="constructing-a-view">
<span id="id1"></span><h3>6.2.1 Constructing a View<a class="headerlink" href="#constructing-a-view" title="Permalink to this headline">¶</a></h3>
<p>A View is an array of zero or more dimensions. Programmers set both the type of entries and the number of dimensions at compile time as part of the type of the View. For example, the following specifies and allocates a View with four dimensions for entries that have type <code class="docutils literal notranslate"><span class="pre">int</span></code>:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="kt">size_t</span> <span class="n">N0</span> <span class="o">=</span> <span class="p">...;</span>
<span class="k">const</span> <span class="kt">size_t</span> <span class="n">N1</span> <span class="o">=</span> <span class="p">...;</span>
<span class="k">const</span> <span class="kt">size_t</span> <span class="n">N2</span> <span class="o">=</span> <span class="p">...;</span>
<span class="k">const</span> <span class="kt">size_t</span> <span class="n">N3</span> <span class="o">=</span> <span class="p">...;</span>
<span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">****&gt;</span> <span class="n">a</span> <span class="p">(</span><span class="s">"some label"</span><span class="p">,</span> <span class="n">N0</span><span class="p">,</span> <span class="n">N1</span><span class="p">,</span> <span class="n">N2</span><span class="p">,</span> <span class="n">N3</span><span class="p">);</span>
</pre></div>
</div>
<p>The string argument is a label which Kokkos uses for debugging. Different Views may have the same label. The ellipses indicate some integer dimensions specified at run time. Users may also set some dimensions at compile time. For example, the following View has two dimensions where the first (represented by the asterisk) is a run-time dimension and the second (represented by [3]) is a compile-time dimension. Thus, the View is an N by 3 array of type double, where N is specified at run time in the View’s constructor.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="kt">size_t</span> <span class="n">N</span> <span class="o">=</span> <span class="p">...;</span>
<span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">*</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">b</span> <span class="p">(</span><span class="s">"another label"</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
</pre></div>
</div>
<p>Views may have up to (at most) 8 dimensions and any number of these may be run-time or compile-time. The only limitation is that the run-time dimensions (if any) must appear first followed by all the compile-time dimensions (if any). For example, the following are valid three-dimensional View types:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">View&lt;int***&gt;</span></code>  (3 run-time dimensions)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">View&lt;int**[8]&gt;</span></code>  (2 run-time, 1 compile-time)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">View&lt;int*[3][8]&gt;</span></code>  (1 run-time, 2 compile-time)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">View&lt;int[4][3][8]&gt;</span></code>  (3 compile-time)</p></li>
</ul>
<p>and the following are <em>not</em> valid three-dimensional View types:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">View&lt;int[4]**&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">View&lt;int[4][3]*&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">View&lt;int[4]*[8]&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">View&lt;int*[3]*&gt;</span></code></p></li>
</ul>
<p>This limitation comes from the implementation of View using C++ templates. View’s first template parameter must be a valid C++ type.</p>
<p>Note that the above used constructor is not necessarily available for all view types; specific Layouts or Memory Spaces may require more specialized allocators. This is discussed later.</p>
<p>Another important thing to keep in mind is that a <code class="docutils literal notranslate"><span class="pre">View</span></code> handle is a stateful object. It is not legal to create a <code class="docutils literal notranslate"><span class="pre">View</span></code> handle from raw memory by typecasting a pointer. To call any operator on a <code class="docutils literal notranslate"><span class="pre">View,</span></code> including the assignment operator, its constructor must have been called before. If it is necessary to initialize raw memory with a <code class="docutils literal notranslate"><span class="pre">View</span></code> handle, one can legally do so using placement new. The above has nothing to do with the data a <code class="docutils literal notranslate"><span class="pre">View</span></code> is referencing. It is completely legal to give a typecast pointer to the constructor of an unmanaged <code class="docutils literal notranslate"><span class="pre">View</span></code>.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">*&gt;</span> <span class="o">*</span><span class="n">a_ptr</span> <span class="o">=</span> <span class="p">(</span><span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">*&gt;*</span><span class="p">)</span> <span class="n">malloc</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">*</span><span class="p">);</span>
<span class="n">a_ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">*&gt;</span><span class="p">(</span><span class="s">"A0"</span><span class="p">,</span><span class="mi">1000</span><span class="p">);</span> <span class="c1">// This is illegal</span>
<span class="k">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">a_ptr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">*&gt;</span><span class="p">(</span><span class="s">"A1"</span><span class="p">,</span><span class="mi">10000</span><span class="p">);</span> <span class="c1">// This is legal </span>
</pre></div>
</div>
</div>
<div class="section" id="what-types-of-data-may-a-view-contain">
<span id="view-types-of-data"></span><h3>6.2.2 What types of data may a View contain?<a class="headerlink" href="#what-types-of-data-may-a-view-contain" title="Permalink to this headline">¶</a></h3>
<p>C++ lets users construct data types that may “look like” numbers in terms of syntax but do arbitrarily complicated things inside. Some of those things may not be thread safe, like unprotected updates to global state. Others may perform badly in parallel, like fine-grained dynamic memory allocation. Therefore, it is strongly advised to use only simple data types inside Kokkos Views. Users may always construct a View whose entries are</p>
<ul class="simple">
<li><p>built-in data types (“plain old data”), like <code class="docutils literal notranslate"><span class="pre">int</span></code> or <code class="docutils literal notranslate"><span class="pre">double</span></code>, or</p></li>
<li><p>structs of built-in data types.</p></li>
</ul>
<p>While it is in principle possible to have Kokkos Views of arbitrary objects, Kokkos imposes restrictions on the set of types <code class="docutils literal notranslate"><span class="pre">T</span></code> for which one can construct a <code class="docutils literal notranslate"><span class="pre">View&lt;T*&gt;</span></code>.  For example:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">T</span></code> must have a default constructor and destructor.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">T</span></code> must not have virtual methods.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">T</span></code>’s default constructor and destructor must not allocate or deallocate data, and must be thread safe.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">T</span></code>’s assignment operators as well as its default constructor and deconstructor must be marked with the <code class="docutils literal notranslate"><span class="pre">KOKKOS_INLINE_FUNCTION</span></code> or <code class="docutils literal notranslate"><span class="pre">KOKKOS_FUNCTION</span></code> macro.</p></li>
</ul>
<p>All restrictions but the first come from the requirement that <code class="docutils literal notranslate"><span class="pre">View&lt;T*&gt;</span></code> work with every execution and memory space,
including those that use CUDA. The constructor of <code class="docutils literal notranslate"><span class="pre">View&lt;T*&gt;</span></code> does not just allocate memory; it also initializes the allocation by iterating over it using a <a class="reference internal" href="../API/core/parallel-dispatch/parallel_for.html"><span class="doc std std-doc"><code class="docutils literal notranslate"><span class="pre">Kokkos::parallel_for</span></code></span></a>, and invoking <code class="docutils literal notranslate"><span class="pre">T</span></code>’s default constructor for each entry. If the View’s execution space is <code class="docutils literal notranslate"><span class="pre">Cuda</span></code>, then that means <code class="docutils literal notranslate"><span class="pre">T</span></code>’s default constructor needs to be correct to call on device. Keep in mind that the semantics of the resulting <code class="docutils literal notranslate"><span class="pre">View</span></code> are a combination of the <code class="docutils literal notranslate"><span class="pre">Views</span> <span class="pre">'view'</span></code> semantics and the behavior of the element type.</p>
<p>The requirement that the destructor of <code class="docutils literal notranslate"><span class="pre">T</span></code> not deallocate memory technically disallows <code class="docutils literal notranslate"><span class="pre">T</span></code> being a managed View, or a structure which directly or indirectly contains a managed View. In extreme cases we do allow users to have managed Views in their type <code class="docutils literal notranslate"><span class="pre">T</span></code>, so long as a non-parallel loop is used to safely deallocate the Views contained in each <code class="docutils literal notranslate"><span class="pre">T</span></code> prior to the deallocation of the <code class="docutils literal notranslate"><span class="pre">View&lt;T&gt;</span></code> itself. This can be done by assigning to each contained View a default-constructed View of the same type. Having managed Views in <code class="docutils literal notranslate"><span class="pre">T</span></code> is not recommended.</p>
<p>Finally, note that virtual functions are technically allowed, but calling them is subject to further restrictions; developers should consult the discussions in Chapter 13, Kokkos and Virtual Functions (under development).</p>
</div>
<div class="section" id="can-i-make-a-view-of-views">
<h3>6.2.3 Can I make a View of Views?<a class="headerlink" href="#can-i-make-a-view-of-views" title="Permalink to this headline">¶</a></h3>
<p>NOVICES: THE ANSWER FOR YOU IS “NO.”  PLEASE SKIP THIS SECTION.</p>
<p>A “View of Views” is a special case of View, where the type of each entry is itself a View. It is possible to make this, but before you try, please see below.</p>
<div class="section" id="you-probably-don-t-want-this">
<h4>6.2.3.1 You probably don’t want this<a class="headerlink" href="#you-probably-don-t-want-this" title="Permalink to this headline">¶</a></h4>
<p>If you really just want a multidimensional array, please don’t do this.  Instead, see <a class="reference internal" href="#constructing-a-view"><span class="std std-ref">Section 6.2.1</span></a> above for the correct syntax.</p>
<p>If you want to represent an array of arrays, and the inner arrays have fixed length or a fixed upper bound on length, consider instead using a ``compressed sparse row’’ data structure. Kokkos’ Containers subpackage has a <code class="docutils literal notranslate"><span class="pre">StaticCrsGraph</span></code> class that you may use for this purpose.</p>
<p>If you want a hash table, Kokkos’ Containers subpackage has an <code class="docutils literal notranslate"><span class="pre">UnorderedMap</span></code> class that you may use for this purpose.</p>
<p>One reason you might <em>actually</em> want a View of Views is because you need a representation of a “ragged” array of arrays – where the inner arrays have widely varying length – and you need to be able to reallocate the inner arrays dynamically.</p>
<p>You might also want a View of some class that itself contains Views. If you want this, first think about how to reorganize your data structures for better efficiency.</p>
</div>
<div class="section" id="what-s-the-problem-with-a-view-of-views">
<h4>6.2.3.2 What’s the problem with a View of Views?<a class="headerlink" href="#what-s-the-problem-with-a-view-of-views" title="Permalink to this headline">¶</a></h4>
<p>A View of Views would have an “outer View,” with zero or more “inner Views.” <a class="reference internal" href="#view-types-of-data"><span class="std std-ref">Section 6.2.2</span></a> above explains how the outer View’s constructor would work.  The outer View’s constructor does not just allocate memory; it also initializes the allocation by iterating over it using a <a class="reference internal" href="../API/core/parallel-dispatch/parallel_for.html"><span class="doc std std-doc"><code class="docutils literal notranslate"><span class="pre">Kokkos::parallel_for</span></code></span></a>, and invoking the entry type’s default constructor for each entry.  If the View’s execution space is <code class="docutils literal notranslate"><span class="pre">Cuda</span></code>, then that means the entry type’s default constructor needs to be correct to call on device. That is a problem, because the entry type in this case is itself View. View’s constructor wants to allocate memory, and thus does not work on device. Kokkos parallel regions generally forbid memory allocation.</p>
<p>You could create the outer View without initializing, like this:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="p">;</span>
<span class="k">using</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">view_alloc</span><span class="p">;</span>
<span class="k">using</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">WithoutInitializing</span><span class="p">;</span>

<span class="c1">// Need an std::string here, because the compiler may get confused</span>
<span class="c1">// if you pass view_alloc a char* as its first argument.</span>
<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">label</span> <span class="p">(</span><span class="s">"v_outer"</span><span class="p">);</span>
<span class="n">View</span><span class="o">&lt;</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">*&gt;&gt;</span> <span class="n">v_outer</span> <span class="p">(</span><span class="n">view_alloc</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">WithoutInitializing</span><span class="p">));</span>
</pre></div>
</div>
<p>However, that leaves the inner Views in an undefined state.  You can’t legally assign to them or call their destructors.  (Remember that View assignment updates the assignee’s reference count.)  You’ll need to do more than just this in order to create valid inner Views and ensure their safe deallocation.</p>
<p>You’ll have worse problems if the outer View’s memory space is <code class="docutils literal notranslate"><span class="pre">CudaSpace</span></code>.  Allocating View construction must run on host in order to allocate memory, but you won’t be able to assign the resulting constructed View to any element of the outer View.</p>
<p>Another issue is that View construction in a Kokkos parallel region does not update the View’s reference count.  Thus, the inner Views must be created in sequential host code, not inside of a <code class="docutils literal notranslate"><span class="pre">Kokkos::parallel_*</span></code>.</p>
</div>
<div class="section" id="i-really-want-a-view-of-views-what-do-i-do">
<h4>6.2.3.3 I really want a View of Views; what do I do?<a class="headerlink" href="#i-really-want-a-view-of-views-what-do-i-do" title="Permalink to this headline">¶</a></h4>
<p>Here is how to create a View of Views, where each inner View has a separate owning allocation:</p>
<ol class="arabic simple">
<li><p>The outer View must have a memory space that is both host and device accessible, such as <code class="docutils literal notranslate"><span class="pre">CudaUVMSpace</span></code>.</p></li>
<li><p>Create the outer View without initializing it.</p></li>
<li><p>Create inner Views using placement new, in a sequential host loop.  (Prefer creating the inner Views uninitialized.  Creating the inner Views initialized launches one device kernel per inner View.  This is likely much slower than just initializing them all yourself from a single kernel over the outer View.)</p></li>
<li><p>At this point, you may access the outer and inner Views on device.</p></li>
<li><p>Before deallocating inner Views, fence to ensure all device kernels that access them have finished.</p></li>
<li><p>Destroy the inner Views explicitly.  (Otherwise, Step 7 will leak the inner Views’ memory.)</p></li>
<li><p>Get rid of the outer View as you normally would.</p></li>
</ol>
<p>Here is an example:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">Cuda</span><span class="p">;</span>
<span class="k">using</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">CudaSpace</span><span class="p">;</span>
<span class="k">using</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">CudaUVMSpace</span><span class="p">;</span>
<span class="k">using</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="p">;</span>
<span class="k">using</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">view_alloc</span><span class="p">;</span>
<span class="k">using</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">WithoutInitializing</span><span class="p">;</span>

<span class="k">using</span> <span class="n">inner_view_type</span> <span class="o">=</span> <span class="n">View</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">*</span><span class="p">,</span> <span class="n">CudaSpace</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">using</span> <span class="n">outer_view_type</span> <span class="o">=</span> <span class="n">View</span><span class="o">&lt;</span><span class="n">inner_view_type</span><span class="o">*</span><span class="p">,</span> <span class="n">CudaUVMSpace</span><span class="o">&gt;</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">numOuter</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">numInner</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="n">outer_view_type</span> <span class="nf">outer</span> <span class="p">(</span><span class="n">view_alloc</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="p">(</span><span class="s">"Outer"</span><span class="p">),</span> <span class="n">WithoutInitializing</span><span class="p">),</span> <span class="n">numOuter</span><span class="p">);</span>

<span class="c1">// Create inner Views on host, outside of a parallel region, uninitialized</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">numOuter</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">label</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="p">(</span><span class="s">"Inner "</span><span class="p">)</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span> <span class="p">(</span><span class="n">k</span><span class="p">);</span>
  <span class="k">new</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">outer</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="n">inner_view_type</span> <span class="p">(</span><span class="n">view_alloc</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">WithoutInitializing</span><span class="p">),</span> <span class="n">numInner</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Outer and inner views are now ready for use on device</span>

<span class="n">Kokkos</span><span class="o">::</span><span class="n">RangePolicy</span><span class="o">&lt;</span><span class="n">Cuda</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">range</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">numOuter</span><span class="p">);</span>
<span class="n">Kokkos</span><span class="o">::</span><span class="n">parallel_for</span> <span class="p">(</span><span class="s">"my kernel label"</span><span class="p">,</span> <span class="n">range</span><span class="p">,</span> 
    <span class="n">KOKKOS_LAMBDA</span> <span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>  
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">numInner</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">device_outer</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="o">*</span> <span class="kt">double</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="kt">double</span> <span class="p">(</span><span class="n">j</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>

<span class="c1">// Fence before deallocation on host, to make sure </span>
<span class="c1">// that the device kernel is done first.</span>
<span class="c1">// Note the new fence syntax that requires an instance.</span>
<span class="c1">// This will work with other CUDA streams, etc.</span>
<span class="n">Cuda</span> <span class="p">().</span><span class="n">fence</span> <span class="p">();</span>

<span class="c1">// Destroy inner Views, again on host, outside of a parallel region.</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">outer</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="o">~</span><span class="n">inner_view_type</span> <span class="p">();</span>
<span class="p">}</span>

<span class="c1">// You're better off disposing of outer immediately.</span>
<span class="n">outer</span> <span class="o">=</span> <span class="n">outer_view_type</span> <span class="p">();</span>
</pre></div>
</div>
<p>Another approach is to create the inner Views as nonowning, from a single pool of memory. This makes it unnecessary to invoke their destructors.</p>
</div>
</div>
<div class="section" id="const-views">
<h3>6.2.4 Const Views<a class="headerlink" href="#const-views" title="Permalink to this headline">¶</a></h3>
<p>A view can have const data semantics (i.e. its entries are read-only) by specifying a <code class="docutils literal notranslate"><span class="pre">const</span></code> data type. It is a compile-time error to assign to an entry of a “const View”. Assignment semantics are equivalent to a pointer to const data. A const View means the <em>entries</em> are const; you may still assign to a const View. <code class="docutils literal notranslate"><span class="pre">View&lt;const</span> <span class="pre">double*&gt;</span></code> corresponds exactly to <code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">double*</span></code>, and <code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">View&lt;double*&gt;</span></code> to <code class="docutils literal notranslate"><span class="pre">double*</span> <span class="pre">const</span></code>. Therefore, it does not make sense to allocate a const View since you could not obtain a non-const view of the same data and you can not assign to it. You can however assign a non-const view to a const view. Here is an example:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="kt">size_t</span> <span class="n">N0</span> <span class="o">=</span> <span class="p">...;</span>
<span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">*&gt;</span> <span class="n">a_nonconst</span> <span class="p">(</span><span class="s">"a_nonconst"</span><span class="p">,</span> <span class="n">N0</span><span class="p">);</span>

<span class="c1">// Assign a nonconst View to a const View</span>
<span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">double</span><span class="o">*&gt;</span> <span class="n">a_const</span> <span class="o">=</span> <span class="n">a_nonconst</span><span class="p">;</span>
<span class="c1">// Pass the const View to some read-only function.</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">result</span> <span class="o">=</span> <span class="n">readOnlyFunction</span> <span class="p">(</span><span class="n">a_const</span><span class="p">);</span>
</pre></div>
</div>
<p>Const Views often enables the compiler to optimize more aggressively by allowing it to reason about possible write conflicts and data aliasing. For example, in a vector update <code class="docutils literal notranslate"><span class="pre">a(i+1)+=b(i)</span></code> with skewed indexing, it is safe to vectorize if <code class="docutils literal notranslate"><span class="pre">b</span></code> is a View of const data.</p>
</div>
<div class="section" id="accessing-entries-indexing">
<h3>6.2.5 Accessing entries (indexing)<a class="headerlink" href="#accessing-entries-indexing" title="Permalink to this headline">¶</a></h3>
<p>You may access an entry of a View using parentheses enclosing a comma-delimited list of integer indices. This looks just like a Fortran multidimensional array access. For example:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="kt">size_t</span> <span class="n">N</span> <span class="o">=</span> <span class="p">...;</span>
<span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">*</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">a</span> <span class="p">(</span><span class="s">"some label"</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
<span class="c1">// KOKKOS_LAMBDA macro includes capture-by-value specifier [=].</span>
<span class="n">Kokkos</span><span class="o">::</span><span class="n">parallel_for</span> <span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">KOKKOS_LAMBDA</span> <span class="p">(</span><span class="k">const</span> <span class="kt">ptrdiff_t</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">const</span> <span class="kt">size_t</span> <span class="n">j</span> <span class="o">=</span> <span class="p">...;</span>
  <span class="k">const</span> <span class="kt">size_t</span> <span class="n">k</span> <span class="o">=</span> <span class="p">...;</span>
  <span class="k">const</span> <span class="kt">double</span> <span class="n">a_ijk</span> <span class="o">=</span> <span class="n">a</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">);</span>
  <span class="cm">/* rest of the loop body */</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Note how in the above example, we only access the View’s entries in a parallel loop body. In general, you may only access a View’s entries in an execution space which is allowed to access that View’s memory space. For example, if the default execution space is <code class="docutils literal notranslate"><span class="pre">Cuda</span></code>, a View for which no specific Memory Space was given may not be accessed in host code<sup>1</sup>.</p>
<p>Furthermore, access costs (e.g., latency and bandwidth) may vary, depending on the View’s “native” memory and execution spaces and the execution space from which you access it. CUDA UVM may work, but it may also be slow, depending on your access pattern and performance requirements. Thus, best practice is to access the View only in a Kokkos parallel for, reduce, or scan, using the same execution space as the View. This also ensures that access to the View’s entries respect first-touch allocation. The first (leftmost) dimension of the View is the <em>parallel dimension</em> over which it is most efficient to do parallel array access if the default memory layout is used (e.g. if no specific memory layout is
specified).</p>
<hr class="docutils"/>
<p><sup>1</sup>  An exemption is if you specified for CUDA compilation that the default memory space is CudaUVMSpace, which can be accessed from the host.</p>
</div>
<hr class="docutils"/>
<div class="section" id="reference-counting">
<h3>6.2.6 Reference counting<a class="headerlink" href="#reference-counting" title="Permalink to this headline">¶</a></h3>
<p>Kokkos automatically manages deallocation of Views through a reference-counting mechanism.  Otherwise, Views behave like raw pointers. Copying or assigning a View does a shallow copy, and changes the reference count. (The View copied has its reference count incremented, and the assigned-to View has its reference count decremented.) A View’s destructor (called when the View falls out of scope or during a stack unwind due to an exception) decrements the reference count. Once the reference count reaches zero, Kokkos may deallocate the View.</p>
<p>For example, the following code allocates two Views, then assigns one to the other. That assignment may deallocate the first View, since it reduces its reference count to zero. It then increases the reference count of the second View, since now both Views point to it.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">*&gt;</span> <span class="n">a</span> <span class="p">(</span><span class="s">"a"</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">*&gt;</span> <span class="n">b</span> <span class="p">(</span><span class="s">"b"</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span> <span class="c1">// assignment does shallow copy</span>
</pre></div>
</div>
<p>For efficiency, View allocation and reference counting turn off inside of Kokkos’ parallel for, reduce, and scan operations. This affects what you can do with Views inside of Kokkos’ parallel operations.</p>
</div>
<div class="section" id="lifetime">
<h3>6.2.6 Lifetime<a class="headerlink" href="#lifetime" title="Permalink to this headline">¶</a></h3>
<p>The lifetime of an allocation begins when a View is constructed by an allocating constructor such as</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">*&gt;</span> <span class="n">b</span><span class="p">(</span><span class="s">"b"</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</pre></div>
</div>
<p>The lifetime of an allocation ends when there are no more Views which reference that allocation (see reference counting above).</p>
<p>Kokkos requires that the lifetime of all allocations ends before the call to <a class="reference internal" href="../API/core/initialize_finalize/finalize.html"><span class="doc std std-doc"><code class="docutils literal notranslate"><span class="pre">Kokkos::finalize</span></code></span></a>!</p>
<p>For example, the following is incorrect usage of Kokkos:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Kokkos</span><span class="o">::</span><span class="n">initialize</span><span class="p">();</span>
  <span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">*&gt;</span> <span class="n">p</span><span class="p">(</span><span class="s">"constructed view"</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
  <span class="n">Kokkos</span><span class="o">::</span><span class="n">finalize</span><span class="p">();</span>
  <span class="c1">// p is destroyed here, after Kokkos::finalize</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="resizing">
<h3>6.2.7 Resizing<a class="headerlink" href="#resizing" title="Permalink to this headline">¶</a></h3>
<p>Kokkos Views can be resized using the <code class="docutils literal notranslate"><span class="pre">resize</span></code> non-member function. It takes an existing view as its input by reference and the new dimension information corresponding to the constructor arguments. A new view with the new dimensions will be created and a kernel will be run in the views execution space to copy the data element by element from the old view to the new one. Note that the old allocation is only deleted if the view to be resized was the <em>only</em> view referencing the underlying allocation.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// Allocate a view with 100x50x4 elements</span>
<span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">**</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">a</span><span class="p">(</span> <span class="s">"a"</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span><span class="mi">50</span><span class="p">);</span>
    
<span class="c1">// Resize a to 200x50x4 elements; the original allocation is freed</span>
<span class="n">Kokkos</span><span class="o">::</span><span class="n">resize</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span><span class="mi">50</span><span class="p">);</span>
    
<span class="c1">// Create a second view b viewing the same data as a</span>
<span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">**</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
<span class="c1">// Resize a again to 300x60x4 elements; b is still 200x50x4</span>
<span class="n">Kokkos</span><span class="o">::</span><span class="n">resize</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="mi">60</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="layout">
<h2>6.3 Layout<a class="headerlink" href="#layout" title="Permalink to this headline">¶</a></h2>
<div class="section" id="strides-and-dimensions">
<h3>6.3.1 Strides and dimensions<a class="headerlink" href="#strides-and-dimensions" title="Permalink to this headline">¶</a></h3>
<p><em>Layout</em> refers to the mapping from a logical multidimensional index <em>(i, j, k, …)</em> to a physical memory offset. Different programming languages may have different layout conventions. For example, Fortran uses <em>column-major</em> or “left” layout, where consecutive entries in the same column of a 2-D array are contiguous in memory. Kokkos calls this <code class="docutils literal notranslate"><span class="pre">LayoutLeft</span></code>. C, C++, and Java use <em>row-major</em> or “right” layout, where consecutive entries in the same row of a 2-D array are contiguous in memory. Kokkos calls this <code class="docutils literal notranslate"><span class="pre">LayoutRight</span></code>.</p>
<p>The generalization of both left and right layouts is “strided.” For a strided layout, each dimension has a <em>stride</em>. The stride for that dimension determines how far apart in memory two array entries are, whose indices in that dimension differ only by one, and whose other indices are all the same. For example, with a 3-D strided view with strides <em>(s_1, s_2, s_3)</em>, entries <em>(i, j, k)</em> and <em>(i, j+1, k)</em> are <em>s_2</em> entries (not bytes) apart in memory. Kokkos calls this <code class="docutils literal notranslate"><span class="pre">LayoutStride</span></code>.</p>
<p>Strides may differ from dimensions. For example, Kokkos reserves the right to pad each dimension for cache or vector alignment. You may access the dimensions of a View using the (ISO/C++ form) <code class="docutils literal notranslate"><span class="pre">extent</span></code> method, which takes the index of the dimension.</p>
<p>Strides are accessed using the <code class="docutils literal notranslate"><span class="pre">stride</span></code> method. It takes a raw integer array, and only fills in as many entries as the rank of the View. For example:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="kt">size_t</span> <span class="n">N0</span> <span class="o">=</span> <span class="p">...;</span>
<span class="k">const</span> <span class="kt">size_t</span> <span class="n">N1</span> <span class="o">=</span> <span class="p">...;</span>
<span class="k">const</span> <span class="kt">size_t</span> <span class="n">N2</span> <span class="o">=</span> <span class="p">...;</span>
<span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">***&gt;</span> <span class="n">a</span> <span class="p">(</span><span class="s">"a"</span><span class="p">,</span> <span class="n">N0</span><span class="p">,</span> <span class="n">N1</span><span class="p">,</span> <span class="n">N2</span><span class="p">);</span>
    
<span class="kt">int</span> <span class="n">dim1</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">extent</span> <span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// returns dimension 1</span>
<span class="kt">size_t</span> <span class="n">strides</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="n">a</span><span class="p">.</span><span class="n">stride</span> <span class="p">(</span><span class="n">strides</span><span class="p">);</span> <span class="c1">// fill 'strides' with strides</span>
</pre></div>
</div>
<p>You may also refer to specific dimensions without a runtime parameter:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="kt">size_t</span> <span class="n">n0</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">extent_0</span> <span class="p">();</span>
<span class="k">const</span> <span class="kt">size_t</span> <span class="n">n2</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">extent_2</span> <span class="p">();</span>
</pre></div>
</div>
<p>Note the return type of <code class="docutils literal notranslate"><span class="pre">extent_N()</span></code> is the <code class="docutils literal notranslate"><span class="pre">size_type</span></code> of the views memory space. This causes some issues if warning-free compilation should be achieved since it will typically be necessary to cast the return value. In particular, in cases where the <code class="docutils literal notranslate"><span class="pre">size_type</span></code> is more conservative than required, it can be beneficial to cast the value to <code class="docutils literal notranslate"><span class="pre">int</span></code> since signed 32-bit integers typically give the best performance when used as index types. In index heavy codes, this performance difference can be significant compared to using <code class="docutils literal notranslate"><span class="pre">size_t</span></code> since the vector length on many architectures is twice as long for 32 bit values as for 64 bit values and signed integers have less stringent overflow testing requirements than unsigned integers.</p>
<p>Users of the BLAS and LAPACK libraries may be familiar with the ideas of layout and stride. These libraries only accept matrices in column-major format. The stride between consecutive entries in the same column is 1, and the stride between consecutive entries in the same row is <code class="docutils literal notranslate"><span class="pre">LDA</span></code> (“leading dimension of the matrix A”). The number of rows may be less than <code class="docutils literal notranslate"><span class="pre">LDA</span></code>, but may not be greater.</p>
</div>
<div class="section" id="other-layouts">
<h3>6.3.2 Other layouts<a class="headerlink" href="#other-layouts" title="Permalink to this headline">¶</a></h3>
<p>Other layouts are possible.  For example, Kokkos has a “tiled” layout, where a tile’s entries are stored contiguously (in either row- or column-major order) and tiles have compile-time dimensions. One may also use Kokkos to implement Morton ordering or variants thereof. In order to write a custom layout one has to define a new layout class and specialise the <code class="docutils literal notranslate"><span class="pre">ViewMapping</span></code> class for that layout. The <code class="docutils literal notranslate"><span class="pre">ViewMapping</span></code> class implements the offset operator as well as stride calculation for regular layouts. A good way to start such a customization is by copying the implementation of <code class="docutils literal notranslate"><span class="pre">LayoutLeft</span></code> and its associated <code class="docutils literal notranslate"><span class="pre">ViewMapping</span></code> specialization, renaming the layout and then change the offset operator.</p>
</div>
<div class="section" id="default-layout-depends-on-execution-space">
<h3>6.3.3 Default layout depends on execution space<a class="headerlink" href="#default-layout-depends-on-execution-space" title="Permalink to this headline">¶</a></h3>
<p>Kokkos selects a View’s default layout for optimal parallel access over the leftmost dimension based on its execution space. For example, <code class="docutils literal notranslate"><span class="pre">View&lt;int**,</span> <span class="pre">Cuda&gt;</span></code> has <code class="docutils literal notranslate"><span class="pre">LayoutLeft</span></code>, so that consecutive threads in the same warp access consecutive entries in memory. This <em>coalesced access</em> gives the code better memory bandwidth.</p>
<p>In contrast, <code class="docutils literal notranslate"><span class="pre">View&lt;int**,</span> <span class="pre">OpenMP&gt;</span></code> has <code class="docutils literal notranslate"><span class="pre">LayoutRight</span></code>, so that a single thread accesses contiguous entries of the array. This avoids wasting cache lines and helps prevent false sharing of a cache line between threads. In <a class="reference internal" href="#managing-data-placement"><span class="std std-ref">Section 6.4</span></a> more details will be discussed.</p>
</div>
<div class="section" id="explicitly-specifying-layout">
<h3>6.3.4 Explicitly specifying layout<a class="headerlink" href="#explicitly-specifying-layout" title="Permalink to this headline">¶</a></h3>
<p>We prefer that users let Kokkos determine a View’s layout, based on its execution space. However, sometimes you really need to specify the layout. For example, the BLAS and LAPACK libraries only accept column-major arrays.  If you want to give a View to the BLAS or LAPACK library, that View must be <code class="docutils literal notranslate"><span class="pre">LayoutLeft</span></code>. You may specify the layout as a template parameter of View. For example:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="kt">size_t</span> <span class="n">N0</span> <span class="o">=</span> <span class="p">...;</span>
<span class="k">const</span> <span class="kt">size_t</span> <span class="n">N1</span> <span class="o">=</span> <span class="p">...;</span>
<span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">**</span><span class="p">,</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">LayoutLeft</span><span class="o">&gt;</span> <span class="n">A</span> <span class="p">(</span><span class="s">"A"</span><span class="p">,</span> <span class="n">N0</span><span class="p">,</span> <span class="n">N1</span><span class="p">);</span>
    
<span class="c1">// Get 'LDA' for BLAS / LAPACK</span>
<span class="kt">int</span> <span class="n">strides</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> <span class="c1">// any integer type works in stride()</span>
<span class="n">A</span><span class="p">.</span><span class="n">stride</span> <span class="p">(</span><span class="n">strides</span><span class="p">);</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">LDA</span> <span class="o">=</span> <span class="n">strides</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</pre></div>
</div>
<p>You may ask a View for its layout via its <code class="docutils literal notranslate"><span class="pre">array_layout</span></code> typedef. This can be helpful for C++ template metaprogramming. For example:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">ViewType</span><span class="o">&gt;</span>
<span class="kt">void</span> <span class="n">callBlas</span> <span class="p">(</span><span class="k">const</span> <span class="n">ViewType</span><span class="o">&amp;</span> <span class="n">A</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">typedef</span> <span class="k">typename</span> <span class="nc">ViewType</span><span class="o">::</span><span class="n">array_layout</span> <span class="n">array_layout</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="n">array_layout</span><span class="p">,</span> <span class="n">LayoutLeft</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">callSomeBlasFunction</span> <span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="p">...);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">invalid_argument</span> <span class="p">(</span><span class="s">"A is not LayoutLeft"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="managing-data-placement">
<span id="id2"></span><h2>6.4 Managing Data Placement<a class="headerlink" href="#managing-data-placement" title="Permalink to this headline">¶</a></h2>
<div class="section" id="memory-spaces">
<h3>6.4.1 Memory spaces<a class="headerlink" href="#memory-spaces" title="Permalink to this headline">¶</a></h3>
<p>Views are allocated by default in the default execution space’s default memory space. You may access the View’s execution space via its <code class="docutils literal notranslate"><span class="pre">execution_space</span></code> typedef, and its memory space via its <code class="docutils literal notranslate"><span class="pre">memory_space</span></code> typedef. You may also specify the memory space explicitly as a template parameter. For example, the following allocates a View in CUDA device memory:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">*</span><span class="p">,</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">CudaSpace</span><span class="o">&gt;</span> <span class="n">a</span> <span class="p">(</span><span class="s">"a"</span><span class="p">,</span> <span class="mi">100000</span><span class="p">);</span>
</pre></div>
</div>
<p>and the following allocates a View in “host” memory, using the default host execution space for first-touch initialization:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">*</span><span class="p">,</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">HostSpace</span><span class="o">&gt;</span> <span class="n">a</span> <span class="p">(</span><span class="s">"a"</span><span class="p">,</span> <span class="mi">100000</span><span class="p">);</span>
</pre></div>
</div>
<p>Since there is no bijective association between execution spaces and memory spaces, Kokkos provides a way to explicitly provide both to a View as a <code class="docutils literal notranslate"><span class="pre">Device</span></code>.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">*</span><span class="p">,</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">Device</span><span class="o">&lt;</span><span class="n">Kokkos</span><span class="o">::</span><span class="n">Cuda</span><span class="p">,</span><span class="n">Kokkos</span><span class="o">::</span><span class="n">CudaUVMSpace</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">a</span> <span class="p">(</span><span class="s">"a"</span><span class="p">,</span> <span class="mi">100000</span><span class="p">);</span>
<span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">*</span><span class="p">,</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">Device</span><span class="o">&lt;</span><span class="n">Kokkos</span><span class="o">::</span><span class="n">OpenMP</span><span class="p">,</span><span class="n">Kokkos</span><span class="o">::</span><span class="n">CudaUVMSpace</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">b</span> <span class="p">(</span><span class="s">"b"</span><span class="p">,</span> <span class="mi">100000</span><span class="p">);</span>
</pre></div>
</div>
<p>In this case <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> will live in the same memory space, but <code class="docutils literal notranslate"><span class="pre">a</span></code> will be initialized on the GPU while <code class="docutils literal notranslate"><span class="pre">b</span></code> will be
initialized on the host. The <code class="docutils literal notranslate"><span class="pre">Device</span></code> type can be accessed as a views <code class="docutils literal notranslate"><span class="pre">device_type</span></code> typedef. A <code class="docutils literal notranslate"><span class="pre">Device</span></code> has only three typedef members: <code class="docutils literal notranslate"><span class="pre">device_type</span></code>, <code class="docutils literal notranslate"><span class="pre">execution_space</span></code> and <code class="docutils literal notranslate"><span class="pre">memory_space</span></code>. The <code class="docutils literal notranslate"><span class="pre">execution_space</span></code> and <code class="docutils literal notranslate"><span class="pre">memory_space</span></code> typedefs are the same for a view as the <code class="docutils literal notranslate"><span class="pre">device_type</span></code> typedef.</p>
<p>It is important to understand that accessibility of a View does not depend on its execution space directly. It is only determined by its memory space. Therefore both <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> have the same access properties. They differ only in how they are initialized and in where parallel kernels associated with operations such as resizing or deep copies are run.</p>
<p>The following is the accessibility matrix for execution and memory spaces:</p>
<div class="table-wrapper"><table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p>Serial</p></th>
<th class="head"><p>OpenMP</p></th>
<th class="head"><p>Threads</p></th>
<th class="head"><p>Cuda</p></th>
<th class="head"><p>ROCm</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>HostSpace</p></td>
<td><p>x</p></td>
<td><p>x</p></td>
<td><p>x</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p>HBWSpace</p></td>
<td><p>x</p></td>
<td><p>x</p></td>
<td><p>x</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p>CudaSpace</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>x</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p>CudaUVMSpace</p></td>
<td><p>x</p></td>
<td><p>x</p></td>
<td><p>x</p></td>
<td><p>x</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p>CudaHostPinnedSpace</p></td>
<td><p>x</p></td>
<td><p>x</p></td>
<td><p>x</p></td>
<td><p>x</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p>ROCmSpace</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>x</p></td>
</tr>
<tr class="row-even"><td><p>ROCmHostPinnedSpace</p></td>
<td><p>x</p></td>
<td><p>x</p></td>
<td><p>x</p></td>
<td><p>-</p></td>
<td><p>x</p></td>
</tr>
</tbody>
</table></div>
<p>This relationship can be queried via the <code class="docutils literal notranslate"><span class="pre">SpaceAccessibility</span></code> class:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="nc">AccessSpace</span> <span class="p">,</span> <span class="k">typename</span> <span class="nc">MemorySpace</span> <span class="o">&gt;</span>
<span class="k">struct</span> <span class="nc">SpaceAccessibility</span> <span class="p">{</span>
  <span class="k">enum</span> <span class="p">{</span> <span class="n">accessible</span> <span class="p">};</span>  <span class="c1">// AccessSpace can access MemorySpace</span>
  <span class="k">enum</span> <span class="p">{</span> <span class="n">assignable</span> <span class="p">};</span>  <span class="c1">// Can assign View&lt;...,AccessSpace,...&gt; = View&lt;...,MemorySpace,...&gt;</span>
  <span class="k">enum</span> <span class="p">{</span> <span class="n">deep_copy</span> <span class="p">};</span>  <span class="c1">// Can deep copy to AccessSpace::memory_space from MemorySpace</span>
<span class="p">};</span>
</pre></div>
</div>
<p>A typical use case would be:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="n">SpaceAccessibility</span><span class="o">&lt;</span><span class="n">ExecSpace</span><span class="p">,</span> <span class="n">ViewType</span><span class="o">::</span><span class="n">memory_space</span><span class="o">&gt;::</span><span class="n">accessible</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">parallel_for</span><span class="p">(</span><span class="n">RangePolicy</span><span class="o">&lt;</span><span class="n">ExecSpace</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">functor</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="initialization">
<h3>6.4.2 Initialization<a class="headerlink" href="#initialization" title="Permalink to this headline">¶</a></h3>
<p>A View’s entries are initialized to zero by default. Initialization happens in parallel for first-touch allocation over the first (leftmost) dimension of the View using the execution space of the View.</p>
<p>You may allocate a View without initializing. For example:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">*&gt;</span> <span class="n">x</span> <span class="p">(</span><span class="n">Kokkos</span><span class="o">::</span><span class="n">ViewAllocateWithoutInitializing</span> <span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="mi">100000</span><span class="p">);</span>
</pre></div>
</div>
<p>This is mainly useful in cases when the initial values of the view are not important because
they will be overwritten without ever being read.
It is still important that the first write to each location be done within a parallel kernel
in a way that reflects how first-touch affinity to threads is desired.
Typically it is sufficient to use the parallel iteration index as the index of the location in the
view to write to.</p>
</div>
<div class="section" id="deep-copy-and-hostmirror">
<h3>6.4.3 Deep copy and HostMirror<a class="headerlink" href="#deep-copy-and-hostmirror" title="Permalink to this headline">¶</a></h3>
<p>Copying data from one view to another, in particular between views in different memory spaces, is called deep copy.
Kokkos never performs a hidden deep copy. To do so a user has to call the <code class="docutils literal notranslate"><span class="pre">deep_copy</span></code> function. For example:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">*&gt;</span> <span class="n">a</span> <span class="p">(</span><span class="s">"a"</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">*&gt;</span> <span class="n">b</span> <span class="p">(</span><span class="s">"b"</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="n">Kokkos</span><span class="o">::</span><span class="n">deep_copy</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span> <span class="c1">// copy contents of b into a</span>
</pre></div>
</div>
<p>Deep copies can only be performed between views with an identical memory layout and padding. For example the following two operations are not valid:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">*</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">CudaSpace</span><span class="o">&gt;</span> <span class="n">a</span> <span class="p">(</span><span class="s">"a"</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">*</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">HostSpace</span><span class="o">&gt;</span> <span class="n">b</span> <span class="p">(</span><span class="s">"b"</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="n">Kokkos</span><span class="o">::</span><span class="n">deep_copy</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span> <span class="c1">// This will give a compiler error</span>

<span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">*</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">LayoutLeft</span><span class="p">,</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">CudaSpace</span><span class="o">&gt;</span> <span class="n">c</span> <span class="p">(</span><span class="s">"c"</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">*</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">LayoutLeft</span><span class="p">,</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">HostSpace</span><span class="o">&gt;</span> <span class="n">d</span> <span class="p">(</span><span class="s">"d"</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="n">Kokkos</span><span class="o">::</span><span class="n">deep_copy</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">);</span> <span class="c1">// This might give a runtime error</span>
</pre></div>
</div>
<p>The first one will not work because the default layouts of <code class="docutils literal notranslate"><span class="pre">CudaSpace</span></code> and <code class="docutils literal notranslate"><span class="pre">HostSpace</span></code> are different. The compiler will catch that since no overload of the <code class="docutils literal notranslate"><span class="pre">deep_copy</span></code> function exists to copy view from one layout to another. The second case will fail at runtime if padding settings are different for the two memory spaces. This would result in different allocation sizes and thus prevent a direct memcopy.</p>
<p>The reasoning for allowing only direct bitwise copies is that a deep copy between different memory spaces would otherwise require a temporary copy of the data to which a bitwise copy is performed followed by a parallel kernel to transfer the data element by element.</p>
<p>Kokkos provides the following way to work around those limitations. First views have a <code class="docutils literal notranslate"><span class="pre">HostMirror</span></code> typedef which is a view type with compatible layout inside the <code class="docutils literal notranslate"><span class="pre">HostSpace</span></code>. Additionally, there is a <code class="docutils literal notranslate"><span class="pre">create_mirror</span></code> and <code class="docutils literal notranslate"><span class="pre">create_mirror_view</span></code> function which allocate views of the <code class="docutils literal notranslate"><span class="pre">HostMirror</span></code> type of view. The difference between the two is that <code class="docutils literal notranslate"><span class="pre">create_mirror</span></code> will always allocate a new view, while <code class="docutils literal notranslate"><span class="pre">create_mirror_view</span></code> will only create a new view if the original one is not in <code class="docutils literal notranslate"><span class="pre">HostSpace</span></code>.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">*</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">MemorySpace</span><span class="o">&gt;</span> <span class="n">a</span> <span class="p">(</span><span class="s">"a"</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="c1">// Allocate a view in HostSpace with the layout and padding of a</span>
<span class="k">typename</span> <span class="nc">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">*</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">MemorySpace</span><span class="o">&gt;::</span><span class="n">HostMirror</span> <span class="n">b</span> <span class="o">=</span>
    <span class="n">create_mirror</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
<span class="c1">// This is always a memcopy</span>
<span class="n">Kokkos</span><span class="o">::</span><span class="n">deep_copy</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">);</span>
    
<span class="k">typename</span> <span class="nc">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">*</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">&gt;::</span><span class="n">HostMirror</span> <span class="n">c</span> <span class="o">=</span>
<span class="n">Kokkos</span><span class="o">::</span><span class="n">create_mirror_view</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
<span class="c1">// This is a no-op if MemorySpace is HostSpace</span>
<span class="n">Kokkos</span><span class="o">::</span><span class="n">deep_copy</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="how-do-i-get-the-raw-pointer">
<h3>6.4.4 How do I get the raw pointer?<a class="headerlink" href="#how-do-i-get-the-raw-pointer" title="Permalink to this headline">¶</a></h3>
<p>We discourage access to a View’s “raw” pointer. This circumvents reference counting, that is, the memory may be deallocated once the View’s reference count goes to zero so holding on to a raw pointer may result in invalid memory access. Furthermore, it may not even be possible to access the View’s memory from a given execution space. For example, a View in the <code class="docutils literal notranslate"><span class="pre">Cuda</span></code> space points to CUDA device memory. Also using raw pointers would normally defeat the usability of polymorpic layouts and automatic padding. Nevertheless, for instances you really need access to the pointer, we provide the <code class="docutils literal notranslate"><span class="pre">data()</span></code> method. For example:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// Legacy function that takes a raw pointer.</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">legacyFunction</span> <span class="p">(</span><span class="kt">double</span><span class="o">*</span> <span class="n">x_raw</span><span class="p">,</span> <span class="k">const</span> <span class="kt">size_t</span> <span class="n">len</span><span class="p">);</span>
  
<span class="c1">// Your function that takes a View.</span>
<span class="kt">void</span> <span class="nf">myFunction</span> <span class="p">(</span><span class="k">const</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">*&gt;&amp;</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// DON'T DO THIS UNLESS YOU MUST</span>
  <span class="kt">double</span><span class="o">*</span> <span class="n">x_raw</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
  <span class="k">const</span> <span class="kt">size_t</span> <span class="n">N</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">extent</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="n">legacyFunction</span> <span class="p">(</span><span class="n">x_raw</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A user is in most cases also allowed to obtain a pointer to a specific element via the usual <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> operator. For example</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// Legacy function that takes a raw pointer.</span>
<span class="kt">void</span> <span class="nf">someLibraryFunction</span> <span class="p">(</span><span class="kt">double</span><span class="o">*</span> <span class="n">x_raw</span><span class="p">);</span>
    
<span class="n">KOKKOS_INLINE_FUNCTION</span>
<span class="kt">void</span> <span class="n">foo</span><span class="p">(</span><span class="k">const</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">*&gt;&amp;</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">someLibraryFunction</span><span class="p">(</span><span class="o">&amp;</span><span class="n">x</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This is only valid if a Views reference type is an <code class="docutils literal notranslate"><span class="pre">lvalue</span></code>. That property can be queried statically at compile time from the view through its <code class="docutils literal notranslate"><span class="pre">reference_is_lvalue</span></code> member.</p>
</div>
</div>
<div class="section" id="access-traits">
<h2>6.5 Access traits<a class="headerlink" href="#access-traits" title="Permalink to this headline">¶</a></h2>
<p>Another way to get optimized data accesses is to specify a memory trait. These traits are used to declare intended use of the particular view of an allocation. For example, a particular kernel might use a view only for streaming writes. By declaring that intention, Kokkos can insert the appropriate store intrinsics on each architecture if available. Access traits are specified through an optional template parameter which comes last in the list of parameters. Multiple traits can be combined with binary “or” operators:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">*</span><span class="p">,</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">MemoryTraits</span><span class="o">&lt;</span><span class="n">SomeTrait</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">a</span><span class="p">;</span>
<span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">double</span><span class="o">*</span><span class="p">,</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">MemoryTraits</span><span class="o">&lt;</span><span class="n">SomeTrait</span> <span class="o">|</span> <span class="n">SomeOtherTrait</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">;</span>
<span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">*</span><span class="p">,</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">LayoutLeft</span><span class="p">,</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">MemoryTraits</span><span class="o">&lt;</span><span class="n">SomeTrait</span> <span class="o">|</span> <span class="n">SomeOtherTrait</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">c</span><span class="p">;</span>
<span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">*</span><span class="p">,</span> <span class="n">MemorySpace</span><span class="p">,</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">MemoryTraits</span><span class="o">&lt;</span><span class="n">SomeTrait</span> <span class="o">|</span> <span class="n">SomeOtherTrait</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">d</span><span class="p">;</span>
<span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">*</span><span class="p">,</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">LayoutLeft</span><span class="p">,</span> <span class="n">MemorySpace</span><span class="p">,</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">MemoryTraits</span><span class="o">&lt;</span><span class="n">SomeTrait</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">e</span><span class="p">;</span>
</pre></div>
</div>
<div class="section" id="atomic-access">
<h3>6.5.1 Atomic access<a class="headerlink" href="#atomic-access" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Atomic</span></code> access trait lets you create a View of data such that every read or write to any entry uses an atomic update. Kokkos supports atomics for all data types independent of size. Restrictions are that you are</p>
<ol class="arabic simple">
<li><p>not allowed to alias data for which atomic operations are performed, and</p></li>
<li><p>the results of non-atomic accesses (including read) to data which is at the same time atomically accessed is not defined.</p></li>
</ol>
<p>Performance characteristics of atomic operations depend on the data type. Some types (in particular integer types) are natively supported and might even provide asynchronous atomic operations. Others (such as 32 bit and 64 bit atomics for non-integer types) are often implemented using CAS loops of integers. Everything else is implemented with a locking approach where an atomic operation acquires a lock based on a hash of the pointer value of the data element.</p>
<p>Types for which atomic access are performed must support the necessary operators such as =, +=, -=, +, - etc. as well as have a number of <code class="docutils literal notranslate"><span class="pre">volatile</span></code> overloads of functions such as assign and copy constructors defined.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">*&gt;</span> <span class="n">a</span><span class="p">(</span><span class="s">"a"</span> <span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
<span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">*</span><span class="p">,</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">MemoryTraits</span><span class="o">&lt;</span><span class="n">Kokkos</span><span class="o">::</span><span class="n">Atomic</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">a_atomic</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
    
<span class="n">a_atomic</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// This access will do an atomic addition</span>
</pre></div>
</div>
</div>
<div class="section" id="random-access">
<h3>6.5.2 Random Access<a class="headerlink" href="#random-access" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">RandomAccess</span></code> trait declares the intent to access a View irregularly (in particular non consecutively). If used for a const View in the <code class="docutils literal notranslate"><span class="pre">CudaSpace</span></code> or <code class="docutils literal notranslate"><span class="pre">CudaUVMSpace</span></code>, Kokkos will use texture fetches for accesses when executing in the <code class="docutils literal notranslate"><span class="pre">Cuda</span></code> execution space. For example:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="kt">size_t</span> <span class="n">N0</span> <span class="o">=</span> <span class="p">...;</span>
<span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">*&gt;</span> <span class="n">a_nonconst</span> <span class="p">(</span><span class="s">"a"</span><span class="p">,</span> <span class="n">N0</span><span class="p">);</span> <span class="c1">// allocate nonconst View</span>
<span class="c1">// Assign to const, RandomAccess View</span>
<span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">int</span><span class="o">*</span><span class="p">,</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">MemoryTraits</span><span class="o">&lt;</span><span class="n">Kokkos</span><span class="o">::</span><span class="n">RandomAccess</span><span class="o">&gt;&gt;</span> <span class="n">a_ra</span> <span class="o">=</span> <span class="n">a_nonconst</span><span class="p">;</span>
</pre></div>
</div>
<p>If the default execution space is <code class="docutils literal notranslate"><span class="pre">Cuda</span></code>, access to a <code class="docutils literal notranslate"><span class="pre">RandomAccess</span></code> View may use CUDA texture fetches. Texture fetches are not cache-coherent with respect to writes, so you must use read-only access. The texture cache is optimized for noncontiguous access since it has a shorter cache line than the regular cache.</p>
<p>While <code class="docutils literal notranslate"><span class="pre">RandomAccess</span></code> is valid for other execution spaces, currently no specific optimizations are performed. But in the future a view allocated with the <code class="docutils literal notranslate"><span class="pre">RandomAccess</span></code> attribute might for example, use a larger page size, and thus reduce page faults in the memory system.</p>
</div>
<div class="section" id="standard-idiom-for-specifying-access-traits">
<h3>6.5.3 Standard idiom for specifying access traits<a class="headerlink" href="#standard-idiom-for-specifying-access-traits" title="Permalink to this headline">¶</a></h3>
<p>The standard idiom for View is to pass it around using as few template parameters as possible. Then, assign to a View with the desired access traits only at the “last moment” when those access traits are needed just before entering a computational kernel. This lets you template C++ classes and functions on the View type without proliferating instantiations. Here is an example:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// Compute a sparse matrix-vector product, for a sparse</span>
<span class="c1">// matrix stored in compressed sparse row (CSR) format.</span>
<span class="kt">void</span> <span class="nf">spmatvec</span> <span class="p">(</span><span class="k">const</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">*&gt;&amp;</span> <span class="n">y</span><span class="p">,</span>
      <span class="k">const</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">size_t</span><span class="o">*&gt;&amp;</span> <span class="n">ptr</span><span class="p">,</span>
      <span class="k">const</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">int</span><span class="o">*&gt;&amp;</span> <span class="n">ind</span><span class="p">,</span>
      <span class="k">const</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">double</span><span class="o">*&gt;&amp;</span> <span class="n">val</span><span class="p">,</span>
      <span class="k">const</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">double</span><span class="o">*&gt;&amp;</span> <span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// Access to x has less locality than access to y.</span>
  <span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">double</span><span class="o">*</span><span class="p">,</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">MemoryTraits</span><span class="o">&lt;</span><span class="n">Kokkos</span><span class="o">::</span><span class="n">RandomAccess</span><span class="o">&gt;&gt;</span> <span class="n">x_ra</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
  <span class="k">typedef</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">size_t</span><span class="o">*&gt;::</span><span class="n">size_type</span> <span class="n">size_type</span><span class="p">;</span>
    
  <span class="n">Kokkos</span><span class="o">::</span><span class="n">parallel_for</span> <span class="p">(</span><span class="n">y</span><span class="p">.</span><span class="n">extent_0</span> <span class="p">(),</span> <span class="n">KOKKOS_LAMBDA</span> <span class="p">(</span><span class="k">const</span> <span class="n">size_type</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">y_i</span> <span class="o">=</span> <span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">k</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">(</span><span class="n">i</span><span class="p">);</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">ptr</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">y_i</span> <span class="o">+=</span> <span class="n">val</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">*</span> <span class="n">x_ra</span><span class="p">(</span><span class="n">ind</span><span class="p">(</span><span class="n">k</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">y_i</span><span class="p">;</span>
  <span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="unmanaged-views">
<h3>6.5.4 Unmanaged Views<a class="headerlink" href="#unmanaged-views" title="Permalink to this headline">¶</a></h3>
<p>It’s always better to let Kokkos control memory allocation, but sometimes you don’t have a choice. You might have to work with an application or an interface that returns a raw pointer, for example. Kokkos lets you wrap raw pointers in an <em>unmanaged View</em>. “Unmanaged” means that Kokkos does <em>not</em> do reference counting or automatic deallocation for those Views. The following example shows how to create an unmanaged View of host memory. You may do this for CUDA device memory too, or indeed for memory allocated in any memory space, by specifying the View’s execution or memory space accordingly.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// Sometimes other code gives you a raw pointer, ...</span>
<span class="k">const</span> <span class="kt">size_t</span> <span class="n">N0</span> <span class="o">=</span> <span class="p">...;</span>
<span class="kt">double</span><span class="o">*</span> <span class="n">x_raw</span> <span class="o">=</span> <span class="n">malloc</span> <span class="p">(</span><span class="n">N0</span> <span class="o">*</span> <span class="k">sizeof</span> <span class="p">(</span><span class="kt">double</span><span class="p">));</span>
<span class="p">{</span>
  <span class="c1">// ... but you want to access it with Kokkos.</span>
  <span class="c1">//</span>
  <span class="c1">// malloc() returns host memory, so we use the host memory space HostSpace.  </span>
  <span class="c1">// Unmanaged Views have no label because labels work with the reference counting system.</span>
  <span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">*</span><span class="p">,</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">HostSpace</span><span class="p">,</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">MemoryTraits</span><span class="o">&lt;</span><span class="n">Kokkos</span><span class="o">::</span><span class="n">Unmanaged</span><span class="o">&gt;</span> <span class="o">&gt;</span>
    <span class="n">x_view</span> <span class="p">(</span><span class="n">x_raw</span><span class="p">,</span> <span class="n">N0</span><span class="p">);</span>
 
  <span class="n">functionThatTakesKokkosView</span> <span class="p">(</span><span class="n">x_view</span><span class="p">);</span>
  
  <span class="c1">// It's safest for unmanaged Views to fall out of scope before freeing their memory.</span>
<span class="p">}</span>
<span class="n">free</span> <span class="p">(</span><span class="n">x_raw</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="conversion-rules-and-function-specialization">
<h3>6.5.5 Conversion Rules and Function Specialization<a class="headerlink" href="#conversion-rules-and-function-specialization" title="Permalink to this headline">¶</a></h3>
<p>Not all view types can be assigned to each other. Requirements are:</p>
<ul class="simple">
<li><p>the data type and dimension have to match,</p></li>
<li><p>the layout must be compatible and</p></li>
<li><p>the memory space has to match.</p></li>
</ul>
<p>Examples illustrating the rules are:</p>
<ol class="arabic simple">
<li><p>Data Type and Rank has to Match</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">int*</span>  <span class="pre">-&gt;</span> <span class="pre">int*</span>          </code>   / ok</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">int*</span>  <span class="pre">-&gt;</span> <span class="pre">const</span> <span class="pre">int*</span>    </code>   / ok</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">int*</span>  <span class="pre">-&gt;</span> <span class="pre">int*</span>    </code>   / not ok, const violation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">int**</span> <span class="pre">-&gt;</span> <span class="pre">int*</span>          </code>   / not ok, rank mismatch</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">int*[3]</span> <span class="pre">-&gt;</span> <span class="pre">int**</span>       </code>   / ok</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">int**</span> <span class="pre">-&gt;</span> <span class="pre">int*[3]</span>       </code>   / ok if runtime dimension check matches</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">int*</span>  <span class="pre">-&gt;</span> <span class="pre">long*</span>         </code>   / not ok, type mismatch</p></li>
</ul>
</li>
<li><p>Layouts must be compatible</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">LayoutRight</span> <span class="pre">-&gt;</span> <span class="pre">LayoutRight</span> </code>  / ok</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LayoutLeft</span> <span class="pre">-&gt;</span> <span class="pre">LayoutRight</span>  </code>  / not ok except for 1D Views</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LayoutLeft</span> <span class="pre">-&gt;</span> <span class="pre">LayoutStride</span> </code>  / ok</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LayoutStride</span> <span class="pre">-&gt;</span> <span class="pre">LayoutLeft</span> </code>  / ok if runtime dimensions allow assignment</p></li>
</ul>
</li>
<li><p>Memory Spaces must match</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Kokkos::View&lt;int*&gt;</span> <span class="pre">-&gt;</span> <span class="pre">Kokkos::View&lt;int*,HostSpace&gt;</span></code>  / ok if default memory space is HostSpace</p></li>
</ul>
</li>
<li><p>Memory Traits</p></li>
</ol>
</div>
</div>
</div>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="ParallelDispatch.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">7. Parallel dispatch</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="Initialization.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">5. Initialization</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2014, National Technology &amp; Engineering Solutions of Sandia, LLC (NTESS) |
          Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
          <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            | <a class="muted-link" href="../_sources/ProgrammingGuide/View.md.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">6: View: Multidimensional array</a><ul>
<li><a class="reference internal" href="#why-kokkos-needs-multidimensional-arrays">6.1 Why Kokkos needs multidimensional arrays</a></li>
<li><a class="reference internal" href="#creating-and-using-a-view">6.2 Creating and using a View</a><ul>
<li><a class="reference internal" href="#constructing-a-view">6.2.1 Constructing a View</a></li>
<li><a class="reference internal" href="#what-types-of-data-may-a-view-contain">6.2.2 What types of data may a View contain?</a></li>
<li><a class="reference internal" href="#can-i-make-a-view-of-views">6.2.3 Can I make a View of Views?</a><ul>
<li><a class="reference internal" href="#you-probably-don-t-want-this">6.2.3.1 You probably don’t want this</a></li>
<li><a class="reference internal" href="#what-s-the-problem-with-a-view-of-views">6.2.3.2 What’s the problem with a View of Views?</a></li>
<li><a class="reference internal" href="#i-really-want-a-view-of-views-what-do-i-do">6.2.3.3 I really want a View of Views; what do I do?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#const-views">6.2.4 Const Views</a></li>
<li><a class="reference internal" href="#accessing-entries-indexing">6.2.5 Accessing entries (indexing)</a></li>
<li><a class="reference internal" href="#reference-counting">6.2.6 Reference counting</a></li>
<li><a class="reference internal" href="#lifetime">6.2.6 Lifetime</a></li>
<li><a class="reference internal" href="#resizing">6.2.7 Resizing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#layout">6.3 Layout</a><ul>
<li><a class="reference internal" href="#strides-and-dimensions">6.3.1 Strides and dimensions</a></li>
<li><a class="reference internal" href="#other-layouts">6.3.2 Other layouts</a></li>
<li><a class="reference internal" href="#default-layout-depends-on-execution-space">6.3.3 Default layout depends on execution space</a></li>
<li><a class="reference internal" href="#explicitly-specifying-layout">6.3.4 Explicitly specifying layout</a></li>
</ul>
</li>
<li><a class="reference internal" href="#managing-data-placement">6.4 Managing Data Placement</a><ul>
<li><a class="reference internal" href="#memory-spaces">6.4.1 Memory spaces</a></li>
<li><a class="reference internal" href="#initialization">6.4.2 Initialization</a></li>
<li><a class="reference internal" href="#deep-copy-and-hostmirror">6.4.3 Deep copy and HostMirror</a></li>
<li><a class="reference internal" href="#how-do-i-get-the-raw-pointer">6.4.4 How do I get the raw pointer?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#access-traits">6.5 Access traits</a><ul>
<li><a class="reference internal" href="#atomic-access">6.5.1 Atomic access</a></li>
<li><a class="reference internal" href="#random-access">6.5.2 Random Access</a></li>
<li><a class="reference internal" href="#standard-idiom-for-specifying-access-traits">6.5.3 Standard idiom for specifying access traits</a></li>
<li><a class="reference internal" href="#unmanaged-views">6.5.4 Unmanaged Views</a></li>
<li><a class="reference internal" href="#conversion-rules-and-function-specialization">6.5.5 Conversion Rules and Function Specialization</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    </body>
</html>