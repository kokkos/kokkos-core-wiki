<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Kokkos Tasking Use Case" href="Tasking.html" /><link rel="prev" title="Tagged Operators" href="TaggedOperators.html" />

    <meta name="generator" content="sphinx-4.3.2, furo 2022.01.02"/>
        <title>Overlapping Host and Device work - Kokkos documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=df49af52631e7917044a9c21a57f7b83170a6dd0" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=fade93df149f7c5fedb3ff897f799dc7d283b420" />
    <link rel="stylesheet" type="text/css" href="../_static/hacks.css" />
    
    


<style>
  body {
    --color-code-background: #002b36;
  --color-code-foreground: #839496;
  
  }
  body[data-theme="dark"] {
    --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
  }
  @media (prefers-color-scheme: dark) {
    body:not([data-theme="light"]) {
      --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
    }
  }
</style></head>
  <body>
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" />
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Kokkos  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">Kokkos  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../programmingguide.html">Programming Guide</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ProgrammingGuide/Introduction.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ProgrammingGuide/Machine-Model.html">2. Machine Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ProgrammingGuide/ProgrammingModel.html">3: Programming Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ProgrammingGuide/Compiling.html">4. Compiling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ProgrammingGuide/Initialization.html">5. Initialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ProgrammingGuide/View.html">6: View: Multidimensional array</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ProgrammingGuide/ParallelDispatch.html">7. Parallel dispatch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ProgrammingGuide/HierarchicalParallelism.html">8. Hierarchical Parallelism</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../ProgrammingGuide/Custom-Reductions.html">9. Custom Reductions</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../ProgrammingGuide/Custom-Reductions-Built-In-Reducers.html">9.1 Built-In-Reducers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ProgrammingGuide/Custom-Reductions-Built-In-Reducers-with-Custom-Scalar-Types.html">9.2 Built-In Reducers with Custom Scalar Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ProgrammingGuide/Custom-Reductions-Custom-Reducers.html">9.3 Custom Reducers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ProgrammingGuide/Atomic-Operations.html">10. Atomic Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ProgrammingGuide/Subviews.html">11: Subviews</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ProgrammingGuide/Interoperability.html">12. Interoperability and Legacy Codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ProgrammingGuide/Kokkos-and-Virtual-Functions.html">13. Kokkos and Virtual Functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../building.html">Build, Install and Use</a></li>
<li class="toctree-l1"><a class="reference internal" href="../keywords.html">CMake Keywords</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../API/core-index.html">API: Core</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../API/core/Initialize-and-Finalize.html">Initialize and Finalize</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../API/core/initialize_finalize/initialize.html">Kokkos::initialize</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/initialize_finalize/finalize.html">Kokkos::finalize</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/initialize_finalize/ScopeGuard.html">Kokkos::ScopeGuard</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../API/core/View.html">View and related</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../API/core/view/create_mirror.html"><code class="docutils literal notranslate"><span class="pre">create_mirror[_view]</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/view/deep_copy.html"><code class="docutils literal notranslate"><span class="pre">deep_copy()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/view/layoutLeft.html"><code class="docutils literal notranslate"><span class="pre">LayoutLeft</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/view/layoutRight.html"><code class="docutils literal notranslate"><span class="pre">LayoutRight</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/view/layoutStride.html"><code class="docutils literal notranslate"><span class="pre">LayoutStride</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/view/realloc.html"><code class="docutils literal notranslate"><span class="pre">realloc</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/view/resize.html"><code class="docutils literal notranslate"><span class="pre">resize</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/view/subview.html"><code class="docutils literal notranslate"><span class="pre">subview</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/view/view.html"><code class="docutils literal notranslate"><span class="pre">View</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/view/view_alloc.html"><code class="docutils literal notranslate"><span class="pre">view_alloc()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/view/view_like.html">View-like Types</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../API/core/ParallelDispatch.html">Parallel Execution/Dispatch</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../API/core/parallel-dispatch/parallel_for.html"><code class="docutils literal notranslate"><span class="pre">parallel_for()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/parallel-dispatch/parallel_reduce.html"><code class="docutils literal notranslate"><span class="pre">parallel_reduce()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/parallel-dispatch/parallel_scan.html"><code class="docutils literal notranslate"><span class="pre">parallel_scan()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/parallel-dispatch/fence.html"><code class="docutils literal notranslate"><span class="pre">fence()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/parallel-dispatch/ParallelForTag.html"><code class="docutils literal notranslate"><span class="pre">ParallelForTag()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/parallel-dispatch/ParallelReduceTag.html"><code class="docutils literal notranslate"><span class="pre">ParallelReduceTag()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/parallel-dispatch/ParallelScanTag.html"><code class="docutils literal notranslate"><span class="pre">ParallelScanTag()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../API/core/builtin_reducers.html">Built-in Reducers</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../API/core/builtinreducers/ReducerConcept.html"><code class="docutils literal notranslate"><span class="pre">ReducerConcept</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/builtinreducers/BAnd.html"><code class="docutils literal notranslate"><span class="pre">BAnd</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/builtinreducers/BOr.html"><code class="docutils literal notranslate"><span class="pre">BOr</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/builtinreducers/LAnd.html"><code class="docutils literal notranslate"><span class="pre">LAnd</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/builtinreducers/LOr.html"><code class="docutils literal notranslate"><span class="pre">LOr</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/builtinreducers/Max.html"><code class="docutils literal notranslate"><span class="pre">Max</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/builtinreducers/MaxLoc.html"><code class="docutils literal notranslate"><span class="pre">MaxLoc</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/builtinreducers/Min.html"><code class="docutils literal notranslate"><span class="pre">Min</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/builtinreducers/MinLoc.html"><code class="docutils literal notranslate"><span class="pre">MinLoc</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/builtinreducers/MinMax.html"><code class="docutils literal notranslate"><span class="pre">MinMax</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/builtinreducers/MinMaxLoc.html"><code class="docutils literal notranslate"><span class="pre">MinMaxLoc</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/builtinreducers/Prod.html"><code class="docutils literal notranslate"><span class="pre">Prod</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/builtinreducers/Sum.html"><code class="docutils literal notranslate"><span class="pre">Sum</span></code></a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../API/core/builtinreducers/ReductionScalarTypes.html">Reduction Scalar Types</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../API/core/builtinreducers/MinMaxLocScalar.html"><code class="docutils literal notranslate"><span class="pre">MinMaxLocScalar</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../API/core/builtinreducers/MinMaxScalar.html"><code class="docutils literal notranslate"><span class="pre">MinMaxScalar</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../API/core/builtinreducers/ValLocScalar.html"><code class="docutils literal notranslate"><span class="pre">ValLocScalar</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../API/core/Execution-Policies.html">Execution Policies</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../API/core/policies/ExecutionPolicyConcept.html"><code class="docutils literal notranslate"><span class="pre">ExecutionPolicy</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/policies/MDRangePolicy.html"><code class="docutils literal notranslate"><span class="pre">MDRangePolicy</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/policies/NestedPolicies.html"><code class="docutils literal notranslate"><span class="pre">NestedPolicies</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/policies/RangePolicy.html"><code class="docutils literal notranslate"><span class="pre">RangePolicy</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/policies/TeamHandleConcept.html"><code class="docutils literal notranslate"><span class="pre">TeamHandleConcept</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/policies/TeamPolicy.html"><code class="docutils literal notranslate"><span class="pre">TeamPolicy</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/policies/TeamThreadRange.html"><code class="docutils literal notranslate"><span class="pre">TeamThreadRange</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/policies/TeamVectorRange.html"><code class="docutils literal notranslate"><span class="pre">TeamVectorRange</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/policies/ThreadVectorRange.html"><code class="docutils literal notranslate"><span class="pre">ThreadVectorRange</span></code></a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../API/core/Spaces.html">Spaces</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../API/core/execution_spaces.html">Execution Spaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/memory_spaces.html">Memory Spaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/SpaceAccessibility.html">Space Accessibility</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../API/core/Task-Parallelism.html">Task-Parallelism</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../API/core/atomics.html">Atomics</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../API/core/atomics/atomic_compare_exchange.html"><code class="docutils literal notranslate"><span class="pre">atomic_compare_exchange</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/atomics/atomic_compare_exchange_strong.html"><code class="docutils literal notranslate"><span class="pre">atomic_compare_exchange_strong</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/atomics/atomic_exchange.html"><code class="docutils literal notranslate"><span class="pre">atomic_exchange</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/atomics/atomic_fetch_op.html"><code class="docutils literal notranslate"><span class="pre">atomic_fetch_[op]</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/atomics/atomic_load.html"><code class="docutils literal notranslate"><span class="pre">atomic_load</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/atomics/atomic_op.html"><code class="docutils literal notranslate"><span class="pre">atomic_[op]</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/atomics/atomic_op_fetch.html"><code class="docutils literal notranslate"><span class="pre">atomic_[op]_fetch</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/atomics/atomic_store.html"><code class="docutils literal notranslate"><span class="pre">atomic_store</span></code></a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../API/core/Numerics.html">Numerics</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../API/core/numerics/mathematical-constants.html">Mathematical constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/numerics/mathematical-functions.html">Common math functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/numerics/numeric-traits.html">Numeric traits</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../API/core/CStyleMemManagement.html">C-style memory management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../API/core/Traits.html">Traits</a></li>
<li class="toctree-l2"><a class="reference internal" href="../API/core/KokkosConcepts.html">Kokkos Concepts</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../API/core/STL-Compatibility.html">STL Compatibility Issues</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../API/core/stl-compat/pair.html"><code class="docutils literal notranslate"><span class="pre">Kokkos::pair</span></code></a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../API/core/Utilities.html">Utilities</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../API/core/utilities/abort.html"><code class="docutils literal notranslate"><span class="pre">Kokkos::abort</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/utilities/complex.html"><code class="docutils literal notranslate"><span class="pre">Kokkos::complex</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/core/utilities/timer.html"><code class="docutils literal notranslate"><span class="pre">Kokkos::Timer</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../API/core/Detection-Idiom.html">Detection Idiom</a></li>
<li class="toctree-l2"><a class="reference internal" href="../API/core/Macros.html">Macros</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../API/containers-index.html">API: Containers</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../API/containers/Bitset.html"><code class="docutils literal notranslate"><span class="pre">Bitset</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../API/containers/Bitset.html#constbitset"><code class="docutils literal notranslate"><span class="pre">ConstBitset</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../API/containers/DualView.html"><code class="docutils literal notranslate"><span class="pre">DualView</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../API/containers/DynamicView.html"><code class="docutils literal notranslate"><span class="pre">DynamicView</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../API/containers/DynRankView.html"><code class="docutils literal notranslate"><span class="pre">DynRankView</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../API/containers/Offset-View.html"><code class="docutils literal notranslate"><span class="pre">OffsetView</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../API/containers/ScatterView.html"><code class="docutils literal notranslate"><span class="pre">ScatterView</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../API/containers/StaticCrsGraph.html"><code class="docutils literal notranslate"><span class="pre">StaticCrsGraph</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../API/containers/Unordered-Map.html"><code class="docutils literal notranslate"><span class="pre">UnorderedMap</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../API/containers/vector.html"><code class="docutils literal notranslate"><span class="pre">vector</span></code></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../API/algorithms-index.html">API: Algorithms</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../API/algorithms/Random-Number.html">Random-Number</a></li>
<li class="toctree-l2"><a class="reference internal" href="../API/algorithms/Random-Number.html#generator">Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../API/algorithms/Sort.html">Sort</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../API/algorithms/std-algorithms-index.html">Std Algorithms</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../API/algorithms/std-algorithms/Iterators.html">Iterators</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/algorithms/std-algorithms/StdMinMaxElement.html">Minimum/maximum</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/algorithms/std-algorithms/StdModSeq.html">Modifying Sequence</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/algorithms/std-algorithms/StdNonModSeq.html">NonModifying Sequence</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/algorithms/std-algorithms/StdNumeric.html">Numeric</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/algorithms/std-algorithms/StdPartioningOps.html">Partitioning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API/algorithms/std-algorithms/StdSorting.html">Sorting</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../API/alphabetical.html">API in Alphabetical Order</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../usecases.html">Use Cases and Examples</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="MPI-Halo-Exchange.html">MPI Halo Exchange</a></li>
<li class="toctree-l2"><a class="reference internal" href="Average-To-Nodes.html">ScatterView averaging elements to nodes</a></li>
<li class="toctree-l2"><a class="reference internal" href="MDRangePolicy.html">MDRangePolicy Use Case</a></li>
<li class="toctree-l2"><a class="reference internal" href="VirtualFunctions.html">Virtual Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="TaggedOperators.html">Tagged Operators</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Overlapping Host and Device work</a></li>
<li class="toctree-l2"><a class="reference internal" href="Tasking.html">Kokkos Tasking Use Case</a></li>
<li class="toctree-l2"><a class="reference internal" href="Kokkos-Fortran-Interoperability.html">Fortran Interop Use Case</a></li>
<li class="toctree-l2"><a class="reference internal" href="SoA-and-AoSoA-with-Cabana.html">Array of Structures and Structure of Arrays with Cabana</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../testing-and-issue-tracking.html">Testing and Issue Tracking</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../testing-and-issue-tracking/Requirements-Issues-and-Feedback.html">Requirements, Issues and Feedback</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing-and-issue-tracking/Testing-Process-Details.html">Attachments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing-and-issue-tracking/Testing-Processes.html">Kokkos Testing Processes and Change Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing-and-issue-tracking/Testing-Workflow-Components.html">Kokkos Testing Workflow Components</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/kokkos/kokkos-tutorials">Tutorials</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../videolectures.html">Video lectures</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference external" href="https://www.youtube.com/watch?v=rUIcWtFU5qM">1. Intro, Build, Parallel dispatch</a></li>
<li class="toctree-l2"><a class="reference external" href="https://www.youtube.com/watch?v=O-asHTtO7O4">2. Views and Spaces</a></li>
<li class="toctree-l2"><a class="reference external" href="https://www.youtube.com/watch?v=nGyJS8u-6GY">3. Multidim loops and Data Structures</a></li>
<li class="toctree-l2"><a class="reference external" href="https://www.youtube.com/watch?v=s9ecpeWRePs">4. Hierarchical Parallelism</a></li>
<li class="toctree-l2"><a class="reference external" href="https://www.youtube.com/watch?v=xEAyOod57-c">5. SIMD, Streams, Tasking</a></li>
<li class="toctree-l2"><a class="reference external" href="https://www.youtube.com/watch?v=1J3JQ3d3cRc&amp;t=1s">6. Fortran/Python interop, MPI, PGAS</a></li>
<li class="toctree-l2"><a class="reference external" href="https://www.youtube.com/watch?v=MH6zFYGw0HU">7. Kokkos Tools</a></li>
<li class="toctree-l2"><a class="reference external" href="https://www.youtube.com/watch?v=_qD4X66MQF8&amp;t=1s">8. Kokkos Kernels Math Library</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/kokkos/kokkos">GitHub Repo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../citation.html">Citing Kokkos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <div class="section" id="overlapping-host-and-device-work">
<h1>Overlapping Host and Device work<a class="headerlink" href="#overlapping-host-and-device-work" title="Permalink to this headline">¶</a></h1>
<p>When using architectures that allow host execution to concur with device execution Kokkos supports
overlapping host operations with device operations which can produce significant speedup depending
on the algorithm.  This use case describes the conditions and the design of algorithms that take advantage of
overlapping device execution with host execution.</p>
<div class="section" id="actors">
<h2>Actors<a class="headerlink" href="#actors" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Algorithm with different set of kernels where some are best executed on the host and some
are better executed on an accelerator device</p></li>
<li><p>Algorithm where communication or serialization operations can be staggered with computational kernels</p></li>
<li><p>Algorithm where work can be divided between host and device without contention to resources</p></li>
</ul>
</div>
<div class="section" id="subjects">
<h2>Subjects<a class="headerlink" href="#subjects" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Kokkos Execution Spaces</p></li>
<li><p>Kokkos Execution Policies</p></li>
<li><p>Kokkos Memory Spaces</p></li>
</ul>
</div>
<div class="section" id="assumptions">
<h2>Assumptions<a class="headerlink" href="#assumptions" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>There is little or no contention with host accessible memory while a device kernel is executing</p></li>
</ul>
</div>
<div class="section" id="constraints">
<h2>Constraints<a class="headerlink" href="#constraints" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Kernels are non-blocking</p></li>
</ul>
</div>
<div class="section" id="preconditions">
<h2>Preconditions<a class="headerlink" href="#preconditions" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Execution “kernel” implemented in the form of C++ functor</p></li>
</ul>
</div>
<div class="section" id="usage-pattern-1-overlapping-computational-kernels">
<h2>Usage Pattern 1 - overlapping computational kernels<a class="headerlink" href="#usage-pattern-1-overlapping-computational-kernels" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">|---</span> <span class="n">Allocate</span> <span class="n">Device</span> <span class="ow">and</span> <span class="n">Host</span> <span class="n">Memory</span>
<span class="o">|---</span> <span class="n">Initialize</span> <span class="n">Host</span> <span class="ow">and</span> <span class="n">Device</span> <span class="n">Memory</span>
<span class="o">|------------------------------------------------</span>
<span class="o">|-</span> <span class="n">Perform</span> <span class="n">host</span> <span class="n">operation</span> <span class="mi">0</span>
<span class="o">|---</span> <span class="n">iteration</span> <span class="n">loop</span> <span class="o">-----------------------------</span>
    <span class="o">|-&gt;-----------</span> <span class="k">global</span> <span class="n">barrier</span> <span class="o">-----------------</span>
    <span class="o">|</span>  <span class="o">|-</span> <span class="n">Synchronize</span> <span class="n">host</span> <span class="ow">and</span> <span class="n">device</span> <span class="n">data</span>
    <span class="o">|</span>  <span class="o">|-</span> <span class="n">Perform</span> <span class="n">device</span> <span class="n">operation</span> <span class="n">N</span> \
    <span class="o">|</span>  <span class="o">|-</span> <span class="n">Perform</span> <span class="n">host</span> <span class="n">operation</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span> <span class="o">/</span> <span class="n">asynchronous</span>
    <span class="o">|-&lt;--------------------------------------------</span>
</pre></div>
</div>
</div>
<div class="section" id="example-code">
<h2>Example Code<a class="headerlink" href="#example-code" title="Permalink to this headline">¶</a></h2>
<p>Perform setup of host data needed for iteration n+1 while device is performing
operation on iteration n</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="kt">double</span> <span class="n">value_type</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">OpenMP</span>   <span class="n">HostExecSpace</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">Cuda</span>     <span class="n">DeviceExecSpace</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">RangePolicy</span><span class="o">&lt;</span><span class="n">DeviceExecSpace</span><span class="o">&gt;</span>  <span class="n">device_range_policy</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">RangePolicy</span><span class="o">&lt;</span><span class="n">HostExecSpace</span><span class="o">&gt;</span>    <span class="n">host_range_policy</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">*</span><span class="p">,</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">CudaSpace</span><span class="o">&gt;</span>   <span class="n">ViewVectorType</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">**</span><span class="p">,</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">CudaSpace</span><span class="o">&gt;</span>  <span class="n">ViewMatrixType</span><span class="p">;</span>

<span class="c1">// Setup data on host  </span>
<span class="c1">// use parameter xVal to demonstrate variability between iterations</span>
<span class="kt">void</span> <span class="nf">init_src_views</span><span class="p">(</span><span class="n">ViewVectorType</span><span class="o">::</span><span class="n">HostMirror</span> <span class="n">p_x</span><span class="p">,</span>
                  <span class="n">ViewMatrixType</span><span class="o">::</span><span class="n">HostMirror</span> <span class="n">p_A</span><span class="p">,</span>
                  <span class="k">const</span> <span class="n">value_type</span> <span class="n">xVal</span> <span class="p">)</span> <span class="p">{</span>
    
  <span class="n">Kokkos</span><span class="o">::</span><span class="n">parallel_for</span><span class="p">(</span> <span class="s">"init_A"</span><span class="p">,</span> <span class="n">host_range_policy</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">),</span> <span class="p">[</span><span class="o">=</span><span class="p">]</span> <span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span> <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">M</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span> <span class="p">)</span> <span class="p">{</span>
      <span class="n">h_A</span><span class="p">(</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="p">)</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="n">Kokkos</span><span class="o">::</span><span class="n">parallel_for</span><span class="p">(</span> <span class="s">"init_x"</span><span class="p">,</span> <span class="n">host_range_policy</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">M</span><span class="p">),</span> <span class="p">[</span><span class="o">=</span><span class="p">]</span> <span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="p">)</span> <span class="p">{</span>
    <span class="n">h_x</span><span class="p">(</span> <span class="n">i</span> <span class="p">)</span> <span class="o">=</span> <span class="n">xVal</span><span class="p">;</span>
  <span class="p">});</span>
<span class="p">}</span>
  
<span class="n">ViewVectorType</span> <span class="nf">y</span><span class="p">(</span> <span class="s">"y"</span><span class="p">,</span> <span class="n">N</span> <span class="p">);</span>
<span class="n">ViewVectorType</span> <span class="nf">x</span><span class="p">(</span> <span class="s">"x"</span><span class="p">,</span> <span class="n">M</span> <span class="p">);</span>
<span class="n">ViewMatrixType</span> <span class="nf">A</span><span class="p">(</span> <span class="s">"A"</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span> <span class="p">);</span>

<span class="n">ViewVectorType</span><span class="o">::</span><span class="n">HostMirror</span> <span class="n">h_y</span> <span class="o">=</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">create_mirror_view</span><span class="p">(</span> <span class="n">y</span> <span class="p">);</span>
<span class="n">ViewVectorType</span><span class="o">::</span><span class="n">HostMirror</span> <span class="n">h_x</span> <span class="o">=</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">create_mirror_view</span><span class="p">(</span> <span class="n">x</span> <span class="p">);</span>
<span class="n">ViewMatrixType</span><span class="o">::</span><span class="n">HostMirror</span> <span class="n">h_A</span> <span class="o">=</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">create_mirror_view</span><span class="p">(</span> <span class="n">A</span> <span class="p">);</span>
  
<span class="k">for</span> <span class="p">(</span> <span class="kt">int</span> <span class="n">repeat</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">repeat</span> <span class="o">&lt;</span> <span class="n">nrepeat</span><span class="p">;</span> <span class="n">repeat</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
  <span class="n">init_src_views</span><span class="p">(</span> <span class="n">h_x</span><span class="p">,</span> <span class="n">h_A</span><span class="p">,</span> <span class="n">repeat</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>  <span class="c1">// setup data for next device launch</span>
  
  <span class="n">Kokkos</span><span class="o">::</span><span class="n">fence</span><span class="p">();</span> <span class="c1">// barrier used to synch between device and host before copying data</span>
    
  <span class="c1">// Deep copy host data needed for this iteration to device.</span>
  <span class="n">Kokkos</span><span class="o">::</span><span class="n">deep_copy</span><span class="p">(</span> <span class="n">h_y</span><span class="p">,</span> <span class="n">h</span> <span class="p">);</span>
  <span class="n">Kokkos</span><span class="o">::</span><span class="n">deep_copy</span><span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">h_x</span> <span class="p">);</span>
  <span class="n">Kokkos</span><span class="o">::</span><span class="n">deep_copy</span><span class="p">(</span> <span class="n">A</span><span class="p">,</span> <span class="n">h_A</span> <span class="p">);</span>  <span class="c1">// implicit barrier</span>

  <span class="c1">// Application: y=Ax</span>
  <span class="n">Kokkos</span><span class="o">::</span><span class="n">parallel_for</span><span class="p">(</span> <span class="s">"yAx"</span><span class="p">,</span> <span class="n">device_range_policy</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">N</span> <span class="p">),</span> 
                              <span class="n">KOKKOS_LAMBDA</span> <span class="p">(</span> <span class="kt">int</span> <span class="n">j</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">temp2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">M</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span> <span class="p">{</span>
      <span class="n">temp2</span> <span class="o">+=</span> <span class="n">A</span><span class="p">(</span> <span class="n">j</span><span class="p">,</span> <span class="n">i</span> <span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="p">(</span> <span class="n">i</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="n">y</span><span class="p">(</span> <span class="n">j</span> <span class="p">)</span> <span class="o">=</span> <span class="n">temp2</span><span class="p">;</span>
  <span class="p">}</span> <span class="p">);</span>
    
  <span class="c1">// note that there is no barrier here, so the host thread will loop</span>
  <span class="c1">// back around and call ini_src_views while the kernel is still running</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Important note</strong>:  In theory, the order in which the host kernel and the device kernel are
launched is not important, but in practice the device kernel must be launched first.  Most
host backends do not leave a “main” thread free while the kernel is running. Once the
host parallel kernel is launched, the main thread is occupied until that thread’s
contribution to the kernel is complete.  Because the device execution is in a different context,
the host thread is free immediately after the kernel is launched.  Attention must
also be paid to the contract associated with the parallel execution pattern.  If the pattern
requires a synchronization prior to completion (such as a reduction), then there is no opportunity to
overlap host and device operations.  Thus, taking advantage of a host/device
overlapping pattern may require modifications to the overall algorithm.</p>
</div>
<div class="section" id="usage-pattern-2-perform-serialized-operation-on-host-while-device-is-executing-kernel">
<h2>Usage pattern 2 - perform serialized operation on host while device is executing kernel<a class="headerlink" href="#usage-pattern-2-perform-serialized-operation-on-host-while-device-is-executing-kernel" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">|---</span> <span class="n">Allocate</span> <span class="n">Device</span> <span class="ow">and</span> <span class="n">Host</span> <span class="n">Memory</span>
<span class="o">|---</span> <span class="n">Initialize</span> <span class="n">Host</span> <span class="ow">and</span> <span class="n">Device</span> <span class="n">Memory</span>
<span class="o">|----------</span> <span class="k">global</span> <span class="n">barrier</span> <span class="o">------------------------------</span>
<span class="o">|-</span> <span class="n">Synchronize</span> <span class="n">host</span> <span class="ow">and</span> <span class="n">device</span> <span class="n">data</span>
<span class="o">|--------------------------------------------------------</span>
    <span class="o">|-&gt;|-</span> <span class="n">Perform</span> <span class="n">device</span> <span class="n">operation</span> <span class="n">N</span>         \ <span class="n">asynchronous</span>
    <span class="o">|</span>  <span class="o">|-</span> <span class="n">Serialize</span> <span class="n">host</span> <span class="n">data</span> <span class="kn">from</span> <span class="nn">N</span> <span class="n">to</span> <span class="n">disk</span> <span class="o">/</span>
    <span class="o">|</span>  <span class="o">|------------</span> <span class="k">global</span> <span class="n">barrier</span> <span class="o">-----------------------</span>
    <span class="o">|</span>  <span class="o">|-</span> <span class="n">Synchronize</span> <span class="n">host</span> <span class="ow">and</span> <span class="n">device</span> <span class="n">data</span> <span class="k">for</span> <span class="n">start</span> <span class="n">of</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span>
    <span class="o">|-&lt;----------------------------------------------------</span>
</pre></div>
</div>
<p>Data serialized to disk is behind by 1 iteration, but it can be performed
asynchronously with the device operation.  Device data for N+1 is copied after
iteration N which is why the barrier is need before the synchronization</p>
</div>
<div class="section" id="id1">
<h2>example code<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">RangePolicy</span><span class="o">&lt;&gt;</span>    <span class="n">range_policy</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">*&gt;</span>    <span class="n">ViewVectorType</span><span class="p">;</span>

<span class="n">ViewVectorType</span> <span class="n">V_r</span><span class="p">;</span>
<span class="n">ViewVectorType</span> <span class="n">V_r1</span><span class="p">;</span>
<span class="n">ViewVectorType</span><span class="o">::</span><span class="n">HostMirror</span> <span class="n">h_V</span> <span class="o">=</span> <span class="n">Kokkos</span><span class="o">::</span><span class="n">create_mirror_view</span><span class="p">(</span> <span class="n">y</span> <span class="p">);</span>

<span class="n">get_initial_state</span><span class="p">(</span><span class="n">h_V</span><span class="p">);</span> <span class="c1">// function to initialize V on host</span>

<span class="n">Kokkos</span><span class="o">::</span><span class="n">deep_copy</span><span class="p">(</span><span class="n">V_r</span><span class="p">,</span> <span class="n">h_V</span><span class="p">);</span>
<span class="n">Kokkos</span><span class="o">::</span><span class="n">deep_copy</span><span class="p">(</span><span class="n">V_r1</span><span class="p">,</span> <span class="n">h_V</span><span class="p">)</span>

<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">R</span><span class="p">;</span> <span class="n">r</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="n">Kokkos</span><span class="o">::</span><span class="n">parallel_for</span><span class="p">(</span><span class="n">range_policy</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">),</span> <span class="n">KOKKOS_LAMBDA</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">V_r1</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">get_RHS_func</span><span class="p">(</span><span class="n">V_r</span><span class="p">);</span>  <span class="c1">//return V_r1(i) for RHS from V_r</span>
  <span class="p">});</span>

  <span class="n">serialize_state</span><span class="p">(</span><span class="n">h_V</span><span class="p">);</span> <span class="c1">// serialize data still in host view_r</span>
 
  <span class="n">Kokkos</span><span class="o">::</span><span class="n">fence</span><span class="p">();</span>  <span class="c1">// synchronize between host and device</span>
 
  <span class="n">Kokkos</span><span class="o">::</span><span class="n">deep_copy</span><span class="p">(</span><span class="n">h_V</span><span class="p">,</span> <span class="n">V_r1</span><span class="p">);</span>  <span class="c1">// update for next iteration</span>
  <span class="n">Kokkos</span><span class="o">::</span><span class="n">deep_copy</span><span class="p">(</span><span class="n">V_r</span><span class="p">,</span> <span class="n">h_V</span><span class="p">);</span>
     
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="Tasking.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Kokkos Tasking Use Case</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="TaggedOperators.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Tagged Operators</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2014, National Technology &amp; Engineering Solutions of Sandia, LLC (NTESS) |
          Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
          <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            | <a class="muted-link" href="../_sources/usecases/OverlappingHostAndDeviceWork.md.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Overlapping Host and Device work</a><ul>
<li><a class="reference internal" href="#actors">Actors</a></li>
<li><a class="reference internal" href="#subjects">Subjects</a></li>
<li><a class="reference internal" href="#assumptions">Assumptions</a></li>
<li><a class="reference internal" href="#constraints">Constraints</a></li>
<li><a class="reference internal" href="#preconditions">Preconditions</a></li>
<li><a class="reference internal" href="#usage-pattern-1-overlapping-computational-kernels">Usage Pattern 1 - overlapping computational kernels</a></li>
<li><a class="reference internal" href="#example-code">Example Code</a></li>
<li><a class="reference internal" href="#usage-pattern-2-perform-serialized-operation-on-host-while-device-is-executing-kernel">Usage pattern 2 - perform serialized operation on host while device is executing kernel</a></li>
<li><a class="reference internal" href="#id1">example code</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    </body>
</html>